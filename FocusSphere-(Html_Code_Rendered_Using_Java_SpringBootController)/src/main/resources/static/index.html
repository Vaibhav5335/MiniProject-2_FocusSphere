<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusSphere | Premium Workspace</title>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: {
                        brand: {
                            400: 'var(--brand-400)',
                            500: 'var(--brand-500)',
                            600: 'var(--brand-600)',
                        }
                    },
                    animation: {
                        'blob': 'blob 15s infinite alternate',
                        'float': 'float 6s ease-in-out infinite',
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
                    },
                    keyframes: {
                        'blob': { '0%': { transform: 'translate(0px, 0px) scale(1)' }, '50%': { transform: 'translate(40px, -60px) scale(1.1)' }, '100%': { transform: 'translate(-30px, 30px) scale(0.9)' } },
                        'float': { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-5px)' } },
                        'slideUp': { 'from': { opacity: 0, transform: 'translateY(20px)' }, 'to': { opacity: 1, transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/howler@2.2.3/dist/howler.min.js"></script>

    <style>
        :root {
            --brand-300: #a5b4fc;
            --brand-400: #818cf8;
            --brand-500: #6366f1;
            --brand-600: #4f46e5;
            --brand-700: #4338ca;
            --brand-800: #3730a3;
            --brand-rgb: 99, 102, 241;
            --accent-400: #f472b6;
            --accent-500: #ec4899;
            --accent-600: #db2777;
            --success-400: #34d399;
            --success-500: #10b981;
            --success-600: #059669;
            --warning-400: #fbbf24;
            --warning-500: #f59e0b;
            --warning-600: #d97706;
            --danger-400: #f87171;
            --danger-500: #ef4444;
            --danger-600: #dc2626;
        }


        body {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            color: #1e293b;
        }

        .dark body {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: #f8fafc;
        }

        .bg-mesh {
            position: fixed;
            inset: 0;
            z-index: -1;
            overflow: hidden;
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            transition: background 0.5s ease;
        }

        .dark .bg-mesh {
            background: linear-gradient(135deg, #0f172a, #1e293b);
        }

        .mesh-blob {
            position: absolute;
            filter: blur(100px);
            opacity: 0.6;
            border-radius: 50%;
            animation: blob 15s infinite alternate;
            transition: background-color 0.5s ease;
        }

        .dark .mesh-blob.one {
            background: var(--brand-600);
            width: 500px;
            height: 500px;
            top: -150px;
            left: -100px;
        }

        .dark .mesh-blob.two {
            background: #db2777;
            width: 400px;
            height: 400px;
            bottom: -100px;
            right: -50px;
            animation-delay: 4s;
            opacity: 0.4;
        }

        .mesh-blob.one {
            background: var(--brand-400);
            width: 500px;
            height: 500px;
            top: -100px;
            left: -100px;
            opacity: 0.5;
        }

        .mesh-blob.two {
            background: #f472b6;
            width: 400px;
            height: 400px;
            bottom: -50px;
            right: -50px;
            animation-delay: 4s;
            opacity: 0.4;
        }


        .glass-panel {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.65));
            backdrop-filter: blur(40px) saturate(1.8) contrast(1.1);
            border: 1px solid rgba(255, 255, 255, 0.95);
            box-shadow:
                0 8px 32px rgba(30, 30, 60, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -1px 0 rgba(0, 0, 0, 0.05);
            border-radius: 2rem;
            transition: all 350ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dark .glass-panel {
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.75), rgba(15, 23, 42, 0.55));
            border: 1px solid rgba(71, 85, 105, 0.7);
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.05),
                inset 0 -1px 0 rgba(0, 0, 0, 0.3);
        }

        .bento-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.65));
            backdrop-filter: blur(40px) saturate(1.8) contrast(1.1);
            border: 1px solid rgba(255, 255, 255, 0.95);
            box-shadow:
                0 8px 32px rgba(30, 30, 60, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -1px 0 rgba(0, 0, 0, 0.05);
            border-radius: 2rem;
            transition: all 350ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        .bento-card:hover {
            box-shadow:
                0 20px 50px rgba(var(--brand-rgb), 0.2),
                0 10px 25px rgba(30, 30, 60, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
            transform: translateY(-4px) scale(1.01);
            border-color: rgba(var(--brand-rgb), 0.3);
        }

        .dark .bento-card {
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.75), rgba(15, 23, 42, 0.55));
            border: 1px solid rgba(71, 85, 105, 0.7);
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.05),
                inset 0 -1px 0 rgba(0, 0, 0, 0.3);
        }

        .dark .bento-card:hover {
            box-shadow:
                0 20px 50px rgba(var(--brand-rgb), 0.3),
                0 10px 25px rgba(0, 0, 0, 0.35),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border-color: rgba(var(--brand-rgb), 0.4);
        }


        .glass-input {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            backdrop-filter: blur(24px) saturate(1.2);
            border: 1px solid rgba(255, 255, 255, 0.7);
            border-radius: 1rem;
            padding: 0.875rem 1.25rem;
            outline: none;
            transition: all 350ms cubic-bezier(0.4, 0, 0.2, 1);
            color: #1f2937;
            width: 100%;
            font-weight: 600;
            box-shadow:
                inset 0 2px 4px rgba(0, 0, 0, 0.05),
                0 2px 8px rgba(30, 30, 60, 0.05);
        }

        .dark .glass-input {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(30, 41, 59, 0.6));
            border: 1px solid rgba(71, 85, 105, 0.8);
            color: #e2e8f0;
            box-shadow:
                inset 0 2px 4px rgba(0, 0, 0, 0.2),
                0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .glass-input:focus {
            border-color: var(--brand-500);
            box-shadow:
                inset 0 2px 4px rgba(0, 0, 0, 0.05),
                0 0 0 3px rgba(var(--brand-rgb), 0.25),
                0 4px 12px rgba(var(--brand-rgb), 0.1);
            transform: translateY(-1px);
        }

        .dark .glass-input:focus {
            box-shadow:
                inset 0 2px 4px rgba(0, 0, 0, 0.2),
                0 0 0 3px rgba(var(--brand-rgb), 0.35),
                0 4px 12px rgba(var(--brand-rgb), 0.15);
        }

        .glass-btn {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, var(--brand-500), var(--brand-600));
            color: white;
            font-weight: 800;
            padding: 0.875rem 1.5rem;
            border-radius: 1rem;
            box-shadow:
                0 10px 25px rgba(var(--brand-rgb), 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 350ms cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            letter-spacing: 0.5px;
        }

        .glass-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow:
                0 15px 35px rgba(var(--brand-rgb), 0.4),
                0 5px 15px rgba(var(--brand-rgb), 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .glass-btn:active {
            transform: translateY(-1px) scale(0.98);
            box-shadow:
                0 5px 15px rgba(var(--brand-rgb), 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .glass-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .glass-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .glass-btn:hover::before {
            left: 100%;
        }


        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(var(--brand-rgb), 0.3);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(var(--brand-rgb), 0.8);
            width: 12px;
        }


        .animate-fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
        }

        .animate-slide-in-left {
            animation: slideInLeft 0.5s cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
        }

        .animate-slide-in-right {
            animation: slideInRight 0.5s cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
        }

        .animate-bounce-in {
            animation: bounceIn 0.7s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }

        .animate-scale-in {
            animation: scaleIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .animate-pulse-subtle {
            animation: pulseSubtle 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        .hover-lift {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .hover-lift:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .dark .hover-lift:hover {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }


        .btn-press {
            transition: transform 0.1s ease;
        }

        .btn-press:active {
            transform: scale(0.95);
        }

        .card-hover {
            transition: all 0.4s cubic-bezier(0.22, 0.61, 0.36, 1);
        }

        .card-hover:hover {
            transform: translateY(-6px) scale(1.03);
            box-shadow:
                0 25px 50px -12px rgba(0, 0, 0, 0.25),
                0 15px 30px rgba(var(--brand-rgb), 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .dark .card-hover:hover {
            box-shadow:
                0 25px 50px -12px rgba(0, 0, 0, 0.5),
                0 15px 30px rgba(var(--brand-rgb), 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }


        .loading-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        .dark .loading-skeleton {
            background: linear-gradient(90deg, #2d3748 25%, #4a5568 50%, #2d3748 75%);
        }


        .glass-morph {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px) saturate(1.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
        }

        .dark .glass-morph {
            background: rgba(15, 23, 42, 0.3);
            border: 1px solid rgba(71, 85, 105, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }


        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }

            50% {
                transform: scale(1.05);
            }

            70% {
                transform: scale(0.9);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        @keyframes pulseSubtle {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.02);
                opacity: 0.9;
            }
        }

        @keyframes scaleIn {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }


        .view-section {
            display: none;
            height: 100%;
            flex-direction: column;
            overflow: hidden;
            animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .view-section.active {
            display: flex;
        }


        .timeline-wrapper {
            position: relative;
            height: 1440px;
        }

        .time-slot {
            height: 60px;
            border-top: 1px dashed rgba(156, 163, 175, 0.2);
            position: relative;
        }

        .time-label {
            position: absolute;
            top: -10px;
            left: 10px;
            font-size: 0.75rem;
            font-weight: 800;
            opacity: 0.4;
        }

        .event-block {
            position: absolute;
            left: 70px;
            right: 15px;
            border-radius: 14px;
            padding: 10px 14px;
            font-size: 0.85rem;
            color: white;
            backdrop-filter: blur(12px);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.25);
            cursor: pointer;
        }

        .event-block:hover {
            transform: translateY(-3px) scale(1.02);
            z-index: 10;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
        }

        .bg-brand-500 {
            background-color: var(--brand-500);
        }

        .bg-pink-500 {
            background-color: var(--accent-500);
        }

        .bg-green-500 {
            background-color: var(--success-500);
        }

        .bg-orange-500 {
            background-color: var(--warning-500);
        }


        .task-checkbox {
            appearance: none;
            width: 1.5rem;
            height: 1.5rem;
            border: 2.5px solid #cbd5e1;
            border-radius: 0.5rem;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .dark .task-checkbox {
            border-color: #4b5563;
        }

        .task-checkbox:checked {
            background: linear-gradient(135deg, var(--brand-500), var(--brand-600));
            border-color: var(--brand-500);
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .task-checkbox:checked::after {
            content: '';
            position: absolute;
            left: 32%;
            top: 15%;
            width: 35%;
            height: 55%;
            border: solid white;
            border-width: 0 2.5px 2.5px 0;
            transform: rotate(45deg);
        }

        @keyframes pop {
            50% {
                transform: scale(1.2);
            }
        }


        .habit-day {
            width: 34px;
            height: 34px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: bold;
            border: 2px solid transparent;
        }

        .habit-day.active {
            background: linear-gradient(135deg, var(--brand-500), var(--brand-600));
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .habit-day.inactive {
            background: rgba(156, 163, 175, 0.15);
            color: transparent;
        }

        .habit-day.inactive:hover {
            background: rgba(156, 163, 175, 0.3);
            border-color: var(--brand-500);
        }

        kbd {
            background: rgba(255, 255, 255, 0.8);
            /* bg-white */
            backdrop-filter: blur(10px);
            color: #6b7280;
            /* text-gray-500 */
            padding: 0.25rem 0.625rem;
            /* py-1 px-2.5 */
            border-radius: 0.5rem;
            /* rounded-lg */
            font-size: 10px;
            /* text-[10px] */
            font-family: monospace;
            /* font-mono */
            font-weight: bold;
            /* font-bold */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            /* shadow-sm */
            border: 1px solid rgba(229, 231, 235, 0.8);
            /* border border-gray-200 */
        }

        .dark kbd {
            background: rgba(31, 41, 55, 0.8);
            /* dark:bg-gray-800 */
            color: #9ca3af;
            /* dark:text-gray-400 */
            border: 1px solid rgba(55, 65, 81, 0.8);
            /* dark:border-gray-700 */
        }


        .scratchpad {
            background-image: linear-gradient(rgba(156, 163, 175, 0.2) 1px, transparent 1px);
            background-size: 100% 2rem;
            line-height: 2rem;
        }


        .weather-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.6) 100%);
            backdrop-filter: blur(30px) saturate(1.5);
            border: 1px solid rgba(255, 255, 255, 0.7);
            border-radius: 1.5rem;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(30, 30, 60, 0.1);
            transition: all 0.3s ease;
        }

        .dark .weather-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(15, 23, 42, 0.5) 100%);
            border: 1px solid rgba(71, 85, 105, 0.6);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .weather-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(var(--brand-rgb), 0.15);
        }


        .music-player {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(40px) saturate(1.8);
            border: 1px solid rgba(255, 255, 255, 0.8);
            border-radius: 1.5rem;
            padding: 1.5rem;
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .dark .music-player {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.8) 0%, rgba(30, 41, 59, 0.6) 100%);
            border: 1px solid rgba(71, 85, 105, 0.7);
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.25);
        }


        .file-attachment {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 1rem;
            padding: 0.75rem;
            margin: 0.5rem 0;
            display: flex;
            align-items: center;
            transition: all 0.2s ease;
        }

        .dark .file-attachment {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.5);
        }

        .file-attachment:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateX(5px);
        }

        .dark .file-attachment:hover {
            background: rgba(30, 41, 59, 0.8);
        }


        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s ease;
            transform-origin: 50% 50%;
        }


        @keyframes pulse-glow {
            0% {
                box-shadow: 0 0 0 0 rgba(var(--brand-rgb), 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(var(--brand-rgb), 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(var(--brand-rgb), 0);
            }
        }

        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }

        @keyframes gradient-shift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .gradient-animation {
            background-size: 200% 200%;
            animation: gradient-shift 3s ease infinite;
        }
    </style>
</head>

<body class="h-screen flex overflow-hidden selection:bg-brand-500 selection:text-white transition-colors duration-500"
    tabindex="0" role="application" aria-label="Nova Workspace Application">

    <div class="bg-mesh">
        <div class="mesh-blob one"></div>
        <div class="mesh-blob two"></div>
    </div>

    <div id="mobile-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 hidden md:hidden transition-opacity"
        onclick="toggleSidebar()"></div>

    <aside id="sidebar"
        class="glass-panel fixed md:static inset-y-0 left-0 z-50 w-[260px] m-4 flex flex-col transform -translate-x-[120%] md:translate-x-0 transition-transform duration-300 flex-shrink-0 border-white/60 dark:border-gray-700/50">
        <div class="p-6 flex items-center justify-between border-b border-gray-200/50 dark:border-gray-800/50">
            <h1
                class="text-3xl font-black bg-clip-text text-transparent bg-gradient-to-r from-brand-400 to-brand-600 tracking-tighter flex items-center drop-shadow-sm">
                <i class="fa-solid fa-layer-group mr-3 text-brand-500 text-2xl"></i>FocusSphere
            </h1>
            <button class="md:hidden text-gray-500 hover:text-brand-500" onclick="toggleSidebar()"><i
                    class="fa-solid fa-xmark text-xl"></i></button>
        </div>

        <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
            <p class="text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest mb-4 px-3">
                Workspace</p>

            <button onclick="navigate('dashboard')"
                class="nav-btn w-full flex items-center space-x-4 px-4 py-3.5 rounded-2xl font-bold transition-all hover:bg-brand-500/10 group active"
                data-target="dashboard" aria-label="Navigate to Dashboard" role="tab" aria-selected="true">
                <div
                    class="w-9 h-9 rounded-xl bg-brand-500/10 flex items-center justify-center group-hover:scale-110 group-hover:text-brand-500 transition-all text-brand-500">
                    <i class="fa-solid fa-border-all"></i>
                </div><span class="text-[15px]">Dashboard</span>
            </button>
            <button onclick="navigate('tasks')"
                class="nav-btn w-full flex items-center space-x-4 px-4 py-3.5 rounded-2xl font-bold transition-all hover:bg-brand-500/10 group"
                data-target="tasks" aria-label="Navigate to Tasks" role="tab" aria-selected="false">
                <div
                    class="w-9 h-9 rounded-xl bg-gray-100 dark:bg-black/30 flex items-center justify-center group-hover:scale-110 group-hover:text-brand-500 transition-all text-gray-500 dark:text-gray-400">
                    <i class="fa-solid fa-check-double"></i>
                </div><span class="text-[15px]">Tasks</span>
            </button>
            <button onclick="navigate('notes')"
                class="nav-btn w-full flex items-center space-x-4 px-4 py-3.5 rounded-2xl font-bold transition-all hover:bg-brand-500/10 group"
                data-target="notes" aria-label="Navigate to Notes" role="tab" aria-selected="false">
                <div
                    class="w-9 h-9 rounded-xl bg-gray-100 dark:bg-black/30 flex items-center justify-center group-hover:scale-110 group-hover:text-brand-500 transition-all text-gray-500 dark:text-gray-400">
                    <i class="fa-solid fa-pen-nib"></i>
                </div><span class="text-[15px]">Notes</span>
            </button>
            <button onclick="navigate('habits')"
                class="nav-btn w-full flex items-center space-x-4 px-4 py-3.5 rounded-2xl font-bold transition-all hover:bg-brand-500/10 group"
                data-target="habits" aria-label="Navigate to Habits" role="tab" aria-selected="false">
                <div
                    class="w-9 h-9 rounded-xl bg-gray-100 dark:bg-black/30 flex items-center justify-center group-hover:scale-110 group-hover:text-brand-500 transition-all text-gray-500 dark:text-gray-400">
                    <i class="fa-solid fa-seedling"></i>
                </div><span class="text-[15px]">Habits</span>
            </button>
            <button onclick="navigate('expenses')"
                class="nav-btn w-full flex items-center space-x-4 px-4 py-3.5 rounded-2xl font-bold transition-all hover:bg-brand-500/10 group"
                data-target="expenses" aria-label="Navigate to Expenses" role="tab" aria-selected="false">
                <div
                    class="w-9 h-9 rounded-xl bg-gray-100 dark:bg-black/30 flex items-center justify-center group-hover:scale-110 group-hover:text-brand-500 transition-all text-gray-500 dark:text-gray-400">
                    <i class="fa-solid fa-wallet"></i>
                </div><span class="text-[15px]">Expenses</span>
            </button>
            <button onclick="navigate('schedule')"
                class="nav-btn w-full flex items-center space-x-4 px-4 py-3.5 rounded-2xl font-bold transition-all hover:bg-brand-500/10 group"
                data-target="schedule" aria-label="Navigate to Schedule" role="tab" aria-selected="false">
                <div
                    class="w-9 h-9 rounded-xl bg-gray-100 dark:bg-black/30 flex items-center justify-center group-hover:scale-110 group-hover:text-brand-500 transition-all text-gray-500 dark:text-gray-400">
                    <i class="fa-solid fa-calendar-days"></i>
                </div><span class="text-[15px]">Schedule</span>
            </button>
            <button onclick="navigate('analytics')"
                class="nav-btn w-full flex items-center space-x-4 px-4 py-3.5 rounded-2xl font-bold transition-all hover:bg-brand-500/10 group"
                data-target="analytics" aria-label="Navigate to Analytics" role="tab" aria-selected="false">
                <div
                    class="w-9 h-9 rounded-xl bg-gray-100 dark:bg-black/30 flex items-center justify-center group-hover:scale-110 group-hover:text-brand-500 transition-all text-gray-500 dark:text-gray-400">
                    <i class="fa-solid fa-chart-line"></i>
                </div><span class="text-[15px]">Analytics</span>
            </button>

        </nav>

        <div class="p-4 border-t border-gray-200/50 dark:border-gray-800/50 space-y-2">
            <button onclick="openSettings()"
                class="w-full px-4 py-3 flex items-center space-x-3 hover:bg-brand-500/10 rounded-2xl transition-colors font-bold text-gray-500 hover:text-brand-500">
                <i class="fa-solid fa-sliders"></i><span>Settings & Theme</span>
            </button>
            <button onclick="toggleTheme()"
                class="w-full bg-brand-500/10 backdrop-blur-md rounded-2xl py-3 flex justify-center items-center space-x-3 hover:bg-brand-500/20 transition-colors shadow-sm border border-brand-500/20">
                <i id="theme-icon" class="fa-solid fa-moon text-brand-500"></i>
                <span id="theme-text" class="font-bold text-brand-500">Dark Mode</span>
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-full min-w-0 p-3 md:p-6 lg:p-8 overflow-hidden relative">

        <header class="glass-panel p-4 px-8 mb-6 flex justify-between items-center flex-shrink-0 z-10 animate-float"
            style="animation-duration: 8s;">
            <div class="flex items-center space-x-4">
                <button
                    class="md:hidden text-2xl text-gray-600 dark:text-gray-300 hover:text-brand-500 transition-colors"
                    onclick="toggleSidebar()"><i class="fa-solid fa-bars-staggered"></i></button>
                <div>
                    <h2 id="greeting" class="text-3xl font-black tracking-tighter text-gray-800 dark:text-white">
                        Welcome!</h2>
                    <p id="current-date" class="text-[13px] font-bold text-brand-500 mt-0.5 uppercase tracking-widest">
                        Loading...</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <button onclick="openSearchModal()"
                    class="hidden md:flex items-center space-x-3 px-5 py-2.5 rounded-2xl bg-white/60 dark:bg-black/30 hover:bg-white dark:hover:bg-black/60 transition-colors border border-gray-200 dark:border-gray-700/50 text-gray-500 group cursor-text shadow-sm backdrop-blur-md">
                    <i class="fa-solid fa-magnifying-glass group-hover:text-brand-500 transition-colors"></i>
                    <span class="text-sm font-bold mr-6">Quick Find...</span>
                    <kbd>Ctrl K</kbd>
                </button>
                <button onclick="togglePomodoro()"
                    class="flex items-center justify-center w-12 h-12 rounded-2xl bg-brand-500/10 hover:bg-brand-500 hover:text-white text-brand-500 transition-all border border-brand-500/20 group shadow-sm tooltip relative">
                    <i class="fa-solid fa-stopwatch text-xl group-hover:scale-110 transition-transform"></i>
                </button>
            </div>
        </header>

        <div class="flex-1 overflow-hidden relative" id="view-container">

            <section id="dashboard" class="view-section active overflow-y-auto pr-2 pb-20">
                <div class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-4 gap-6 mb-6 flex-shrink-0 animate-fade-in">

                    <div
                        class="bento-card p-6 md:col-span-2 flex flex-col relative overflow-hidden group card-hover animate-fade-in">
                        <div
                            class="absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-brand-500/25 to-accent-500/25 rounded-full blur-3xl pointer-events-none animate-float">
                        </div>
                        <div
                            class="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-tr from-purple-500/20 to-pink-500/20 rounded-full blur-2xl pointer-events-none animate-pulse-subtle">
                        </div>
                        <div class="flex justify-between items-center mb-4 z-10">
                            <h3
                                class="text-xl font-black text-gray-800 dark:text-white flex items-center group-hover:text-brand-500 transition-colors">
                                <i class="fa-solid fa-pen-clip text-brand-500 mr-3 text-lg"></i>Quick Notes
                            </h3>
                            <div class="flex items-center space-x-2">
                                <span
                                    class="text-[9px] font-black uppercase tracking-widest text-brand-500 bg-brand-500/10 px-2 py-1 rounded-full"
                                    id="scratchpad-status">Auto-saved</span>
                                <button onclick="clearScratchpad()"
                                    class="text-gray-400 hover:text-red-500 transition-colors text-sm">
                                    <i class="fa-solid fa-trash-can"></i>
                                </button>
                            </div>
                        </div>
                        <textarea id="scratchpad-input"
                            class="w-full flex-1 bg-transparent resize-none outline-none text-gray-700 dark:text-gray-300 font-medium scratchpad custom-scrollbar z-10 placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-300 focus:placeholder-transparent"
                            placeholder="Jot down quick thoughts here..."></textarea>


                        <div
                            class="mt-5 weather-card bento-card p-4 bg-gradient-to-br from-blue-50/80 to-cyan-50/80 dark:from-blue-900/30 dark:to-cyan-900/30 border border-blue-200/50 dark:border-blue-800/50 backdrop-blur-sm animate-scale-in">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-bold text-gray-700 dark:text-gray-300 flex items-center text-sm">
                                    <i class="fa-solid fa-cloud-sun mr-2 text-brand-500 animate-pulse"></i>Weather Today
                                </h4>
                                <button onclick="refreshWeather()"
                                    class="text-gray-400 hover:text-brand-500 transition-all duration-300 hover:rotate-90">
                                    <i class="fa-solid fa-arrows-rotate"></i>
                                </button>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-2xl font-black text-gray-800 dark:text-white tracking-tight"
                                        id="weather-temp">--¬∞</div>
                                    <div class="text-xs font-bold text-gray-500 mt-1" id="weather-desc">Loading...</div>
                                </div>
                                <div class="text-4xl animate-float" id="weather-icon">üå§Ô∏è</div>
                            </div>
                        </div>
                    </div>

                    <div class="bento-card p-6 cursor-pointer flex flex-col justify-between hover:shadow-lg transition-all duration-300 card-hover animate-slide-in-left"
                        onclick="navigate('tasks')">
                        <div class="flex justify-between items-start mb-3">
                            <p
                                class="text-[11px] font-black text-brand-500 uppercase tracking-widest bg-brand-500/10 px-2 py-1 rounded-full">
                                Pending Tasks</p>
                            <div
                                class="w-8 h-8 rounded-full bg-gradient-to-br from-brand-500/20 to-brand-600/20 flex items-center justify-center text-brand-500 animate-pulse">
                                <i class="fa-solid fa-check-double text-sm"></i>
                            </div>
                        </div>
                        <div class="flex justify-between items-end">
                            <div>
                                <h3 class="text-5xl font-black bg-gradient-to-r from-brand-500 to-brand-600 bg-clip-text text-transparent tracking-tight"
                                    id="dash-task-count">0</h3>
                                <p class="text-xs text-gray-500 mt-1">tasks to complete</p>
                            </div>
                            <div
                                class="w-14 h-14 rounded-2xl bg-gradient-to-br from-brand-500/20 to-brand-600/20 flex items-center justify-center text-brand-500 text-xl shadow-lg group-hover:animate-bounce">
                                <i class="fa-solid fa-check-double"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bento-card p-6 cursor-pointer flex flex-col justify-between hover:shadow-lg transition-all duration-300 card-hover animate-slide-in-right"
                        onclick="navigate('expenses')">
                        <div class="flex justify-between items-start mb-3">
                            <p
                                class="text-[11px] font-black text-orange-500 uppercase tracking-widest bg-orange-500/10 px-2 py-1 rounded-full">
                                Total Spent</p>
                            <div
                                class="w-8 h-8 rounded-full bg-gradient-to-br from-orange-500/20 to-red-500/20 flex items-center justify-center text-orange-500 animate-pulse">
                                <i class="fa-solid fa-wallet text-sm"></i>
                            </div>
                        </div>
                        <div class="flex justify-between items-end">
                            <div>
                                <h3 class="text-4xl font-black bg-gradient-to-r from-orange-500 to-red-500 bg-clip-text text-transparent tracking-tight truncate"
                                    id="dash-expense-total">$0</h3>
                                <p class="text-xs text-gray-500 mt-1">this month</p>
                            </div>
                            <div
                                class="w-14 h-14 rounded-2xl bg-gradient-to-br from-orange-500/20 to-red-500/20 flex items-center justify-center text-white text-xl shadow-lg shadow-orange-500/30 group-hover:animate-bounce">
                                <i class="fa-solid fa-wallet"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 flex-shrink-0 animate-fade-in">
                    <div class="bento-card p-8 lg:col-span-2 card-hover animate-scale-in">
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center space-x-3">
                                <div
                                    class="w-10 h-10 rounded-2xl bg-gradient-to-br from-brand-500/20 to-purple-500/20 flex items-center justify-center text-brand-500">
                                    <i class="fa-solid fa-chart-line"></i>
                                </div>
                                <h3 class="text-2xl font-black text-gray-800 dark:text-white">Activity Flow</h3>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span
                                    class="text-[10px] font-black px-3 py-1.5 bg-gradient-to-r from-brand-500/15 to-purple-500/15 text-brand-500 rounded-full uppercase tracking-widest border border-brand-500/30">7
                                    Days</span>
                                <button onclick="refreshChart()"
                                    class="text-gray-400 hover:text-brand-500 transition-all duration-300 hover:rotate-90">
                                    <i class="fa-solid fa-arrows-rotate"></i>
                                </button>
                            </div>
                        </div>
                        <div
                            class="relative w-full h-64 bg-gradient-to-br from-gray-50/50 to-gray-100/50 dark:from-gray-800/30 dark:to-gray-900/30 rounded-2xl p-4 border border-gray-200/50 dark:border-gray-700/50">
                            <canvas id="mainChart"></canvas>
                        </div>
                    </div>

                    <div class="flex flex-col gap-6 animate-slide-in-right">
                        <div class="bento-card p-6 cursor-pointer flex items-center justify-between hover:shadow-lg transition-shadow card-hover"
                            onclick="navigate('schedule')">
                            <div>
                                <p class="text-[12px] font-black text-gray-500 uppercase tracking-widest mb-1">Events
                                    Today</p>
                                <h3 class="text-4xl font-black bg-gradient-to-r from-purple-500 to-purple-600 bg-clip-text text-transparent tracking-tighter"
                                    id="dash-event-count">0</h3>
                            </div>
                            <div
                                class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500/20 to-purple-600/20 flex items-center justify-center text-purple-500 text-2xl shadow-lg">
                                <i class="fa-solid fa-calendar-day"></i>
                            </div>
                        </div>


                        <div class="glass-panel p-6 flex flex-col justify-between">
                            <p class="text-[13px] font-bold text-gray-500 uppercase tracking-wider mb-2">How are you
                                feeling?</p>
                            <div class="flex justify-between items-center mt-2">
                                <button onclick="logMood('Awesome', this)"
                                    class="text-4xl hover:scale-125 transition-transform hover:drop-shadow-lg opacity-70 hover:opacity-100 mood-btn filter grayscale hover:grayscale-0">ü§©</button>
                                <button onclick="logMood('Good', this)"
                                    class="text-4xl hover:scale-125 transition-transform hover:drop-shadow-lg opacity-70 hover:opacity-100 mood-btn filter grayscale hover:grayscale-0">üôÇ</button>
                                <button onclick="logMood('Tired', this)"
                                    class="text-4xl hover:scale-125 transition-transform hover:drop-shadow-lg opacity-70 hover:opacity-100 mood-btn filter grayscale hover:grayscale-0">ü•±</button>
                                <button onclick="logMood('Stressed', this)"
                                    class="text-4xl hover:scale-125 transition-transform hover:drop-shadow-lg opacity-70 hover:opacity-100 mood-btn filter grayscale hover:grayscale-0">ü§Ø</button>
                            </div>
                        </div>

                        <div
                            class="bento-card p-8 flex-1 flex flex-col justify-center items-center text-center relative overflow-hidden group bg-gradient-to-br from-brand-500 to-brand-600 text-white border-transparent gradient-animation">
                            <div class="absolute inset-0 bg-gradient-to-br from-white/20 to-transparent"></div>
                            <i
                                class="fa-solid fa-bolt text-5xl mb-6 z-10 opacity-80 group-hover:scale-110 transition-transform"></i>
                            <p class="text-xl font-bold leading-relaxed z-10 shadow-sm" id="quote-text">"In FocusSphere,
                                focus meets productivity."</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="tasks" class="view-section">
                <div class="glass-panel p-6 md:p-8 flex flex-col h-full overflow-hidden">
                    <div class="flex justify-between items-end mb-6 flex-shrink-0">
                        <div class="flex items-center space-x-4">
                            <div
                                class="w-12 h-12 rounded-2xl bg-gradient-to-br from-brand-500/20 to-purple-500/20 flex items-center justify-center text-brand-500 animate-pulse">
                                <i class="fa-solid fa-tasks"></i>
                            </div>
                            <h2 class="text-3xl font-black text-gray-800 dark:text-white tracking-tight">Action Items
                            </h2>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span
                                class="text-sm font-black bg-gradient-to-r from-brand-500/15 to-purple-500/15 text-brand-500 px-4 py-1.5 rounded-xl border border-brand-500/30 shadow-sm animate-pulse-subtle"
                                id="task-progress-text">0% Done</span>
                            <button onclick="refreshTaskStats()"
                                class="text-gray-400 hover:text-brand-500 transition-all duration-300 hover:rotate-90">
                                <i class="fa-solid fa-arrows-rotate"></i>
                            </button>
                        </div>
                    </div>

                    <form id="task-form" class="flex flex-col md:flex-row gap-4 mb-6 flex-shrink-0 animate-fade-in"
                        onsubmit="handleAddTask(event)">
                        <div class="relative flex-1">
                            <input type="text" id="task-input" placeholder="E.g., Review presentation #work"
                                class="glass-input pl-5 text-lg border-brand-500/30 focus:border-brand-500 w-full transition-all duration-300 hover:shadow-lg"
                                required autocomplete="off" aria-label="Task title" aria-describedby="task-help">
                            <div id="task-help" class="sr-only">Enter your task title. Use # followed by words to add
                                tags.</div>
                            <span
                                class="absolute right-4 top-1/2 -translate-y-1/2 text-[10px] font-black text-brand-500 uppercase tracking-widest hidden md:block animate-pulse-subtle">Type
                                # to add tags</span>
                        </div>
                        <input type="date" id="task-date"
                            class="glass-input md:w-44 text-sm font-bold text-gray-500 transition-all duration-300 hover:border-brand-500/50"
                            aria-label="Due date">
                        <select id="task-priority"
                            class="glass-input md:w-40 cursor-pointer font-bold text-sm text-gray-600 dark:text-gray-300 transition-all duration-300 hover:border-brand-500/50">
                            <option value="low" class="text-black">üîΩ Low</option>
                            <option value="medium" class="text-black" selected>‚è∫Ô∏è Medium</option>
                            <option value="high" class="text-black">üîº High</option>
                        </select>
                        <button type="submit"
                            class="glass-btn whitespace-nowrap px-8 py-3 text-lg group hover:shadow-xl transition-all duration-300">
                            <i class="fa-solid fa-arrow-up group-hover:rotate-45 transition-transform"></i>
                        </button>
                        <button type="button" onclick="openAdvancedTaskModal()"
                            class="glass-btn whitespace-nowrap px-6 py-3 text-lg bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 border-purple-500/30 group transition-all duration-300 hover:shadow-xl">
                            <i class="fa-solid fa-plus mr-2 group-hover:scale-110 transition-transform"></i>Advanced
                        </button>
                    </form>

                    <div
                        class="flex justify-between items-center mb-4 px-2 flex-shrink-0 border-b border-gray-200 dark:border-gray-700/50 pb-4">
                        <div class="flex items-center space-x-3">
                            <i class="fa-solid fa-filter text-brand-500"></i>
                            <select id="task-filter"
                                class="bg-transparent font-black outline-none text-gray-500 dark:text-gray-400 text-sm cursor-pointer hover:text-brand-500 transition-all duration-300 hover:scale-105"
                                onchange="renderTasks()">
                                <option value="all" class="text-black">All Tasks</option>
                                <option value="active" class="text-black">Active Only</option>
                                <option value="completed" class="text-black">Completed Only</option>
                            </select>
                        </div>
                        <button onclick="clearCompletedTasks()"
                            class="text-[11px] font-black text-gray-400 hover:text-red-500 transition-all duration-300 uppercase tracking-widest bg-gray-100 dark:bg-gray-800/50 hover:bg-red-50 dark:hover:bg-red-900/30 px-3 py-2 rounded-xl group hover:scale-105">
                            <i class="fa-solid fa-broom mr-2 group-hover:rotate-12 transition-transform"></i>Clear
                            Complete
                        </button>
                    </div>

                    <div class="flex-1 overflow-y-auto pr-2 space-y-3 pb-24" id="task-list"></div>


                    <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4 animate-fade-in">
                        <div class="bento-card p-4 text-center hover:border-brand-500/30 transition-all duration-300 card-hover group animate-scale-in"
                            style="animation-delay: 0.1s">
                            <div
                                class="w-12 h-12 rounded-2xl bg-gradient-to-br from-brand-500/20 to-purple-500/20 flex items-center justify-center text-brand-500 mx-auto mb-3 group-hover:animate-bounce">
                                <i class="fa-solid fa-check"></i>
                            </div>
                            <div class="text-2xl font-black bg-gradient-to-r from-brand-500 to-purple-500 bg-clip-text text-transparent"
                                id="completed-tasks-count">0</div>
                            <div class="text-xs font-bold text-gray-500 uppercase tracking-widest">Completed</div>
                            <div
                                class="mt-2 h-1 bg-gradient-to-r from-brand-500/20 to-purple-500/20 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-brand-500 to-purple-500 rounded-full w-3/4 animate-pulse"
                                    style="width: 75%"></div>
                            </div>
                        </div>
                        <div class="bento-card p-4 text-center hover:border-orange-500/30 transition-all duration-300 card-hover group animate-scale-in"
                            style="animation-delay: 0.2s">
                            <div
                                class="w-12 h-12 rounded-2xl bg-gradient-to-br from-orange-500/20 to-red-500/20 flex items-center justify-center text-orange-500 mx-auto mb-3 group-hover:animate-bounce">
                                <i class="fa-solid fa-clock"></i>
                            </div>
                            <div class="text-2xl font-black bg-gradient-to-r from-orange-500 to-red-500 bg-clip-text text-transparent"
                                id="pending-tasks-count">0</div>
                            <div class="text-xs font-bold text-gray-500 uppercase tracking-widest">Pending</div>
                            <div
                                class="mt-2 h-1 bg-gradient-to-r from-orange-500/20 to-red-500/20 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-orange-500 to-red-500 rounded-full w-2/3 animate-pulse"
                                    style="width: 66%"></div>
                            </div>
                        </div>
                        <div class="bento-card p-4 text-center hover:border-green-500/30 transition-all duration-300 card-hover group animate-scale-in"
                            style="animation-delay: 0.3s">
                            <div
                                class="w-12 h-12 rounded-2xl bg-gradient-to-br from-green-500/20 to-emerald-500/20 flex items-center justify-center text-green-500 mx-auto mb-3 group-hover:animate-bounce">
                                <i class="fa-solid fa-exclamation"></i>
                            </div>
                            <div class="text-2xl font-black bg-gradient-to-r from-green-500 to-emerald-500 bg-clip-text text-transparent"
                                id="high-priority-count">0</div>
                            <div class="text-xs font-bold text-gray-500 uppercase tracking-widest">High Priority</div>
                            <div
                                class="mt-2 h-1 bg-gradient-to-r from-green-500/20 to-emerald-500/20 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-full w-1/2 animate-pulse"
                                    style="width: 50%"></div>
                            </div>
                        </div>
                        <div class="bento-card p-4 text-center hover:border-purple-500/30 transition-all duration-300 card-hover group animate-scale-in"
                            style="animation-delay: 0.4s">
                            <div
                                class="w-12 h-12 rounded-2xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center text-purple-500 mx-auto mb-3 group-hover:animate-bounce">
                                <i class="fa-solid fa-calendar-xmark"></i>
                            </div>
                            <div class="text-2xl font-black bg-gradient-to-r from-purple-500 to-pink-500 bg-clip-text text-transparent"
                                id="overdue-count">0</div>
                            <div class="text-xs font-bold text-gray-500 uppercase tracking-widest">Overdue</div>
                            <div
                                class="mt-2 h-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full w-1/4 animate-pulse"
                                    style="width: 25%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="notes" class="view-section">
                <div class="flex flex-col lg:flex-row gap-6 h-full overflow-hidden">
                    <div
                        class="glass-panel p-5 w-full lg:w-[350px] flex flex-col h-[40%] lg:h-full flex-shrink-0 relative overflow-hidden animate-slide-in-left">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div
                                    class="w-10 h-10 rounded-2xl bg-gradient-to-br from-yellow-500/20 to-orange-500/20 flex items-center justify-center text-yellow-500 animate-pulse">
                                    <i class="fa-solid fa-book"></i>
                                </div>
                                <h3 class="text-xl font-black text-gray-800 dark:text-white">Documents</h3>
                            </div>
                            <span
                                class="text-xs font-black text-gray-500 bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded-full"
                                id="notes-count">0 notes</span>
                        </div>
                        <button onclick="createNewNote()"
                            class="glass-btn w-full mb-5 py-3.5 relative z-10 text-lg border border-white/20 group hover:shadow-xl transition-all duration-300">
                            <i class="fa-solid fa-pen-to-square mr-2 group-hover:rotate-12 transition-transform"></i>New
                            Document
                        </button>
                        <div class="relative mb-4 z-10">
                            <i
                                class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 transition-colors group-hover:text-brand-500"></i>
                            <input type="text" id="note-search" placeholder="Search documents..."
                                class="glass-input pl-11 py-3 text-sm shadow-sm transition-all duration-300 hover:shadow-lg focus:shadow-xl"
                                oninput="renderNotes()">
                        </div>
                        <div id="notes-list"
                            class="flex-1 overflow-y-auto space-y-3 pr-2 z-10 pb-20 lg:pb-0 custom-scrollbar"></div>
                        <div
                            class="absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-white dark:from-gray-900 to-transparent pointer-events-none">
                        </div>
                    </div>

                    <div
                        class="glass-panel w-full flex-1 flex flex-col h-[60%] lg:h-full relative bg-white/40 dark:bg-gray-900/40 border-white/80 dark:border-gray-700/50 animate-slide-in-right">
                        <div id="note-editor-empty"
                            class="absolute inset-0 flex flex-col items-center justify-center opacity-60 animate-fade-in">
                            <div
                                class="w-24 h-24 rounded-[2rem] bg-gradient-to-br from-blue-100 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/30 flex items-center justify-center shadow-inner mb-6 animate-float">
                                <i class="fa-solid fa-file-lines text-4xl text-blue-500"></i>
                            </div>
                            <h3 class="text-2xl font-black mb-2 text-gray-600 dark:text-gray-300">No Document Selected
                            </h3>
                            <p class="text-gray-500 text-sm">Select a document or create a new one to start writing</p>
                        </div>

                        <div id="note-editor" class="hidden flex-col h-full p-6 md:p-8 relative">
                            <div class="flex justify-between items-center mb-6">
                                <div class="flex items-center space-x-3">
                                    <div
                                        class="w-12 h-12 rounded-2xl bg-gradient-to-br from-blue-500/20 to-cyan-500/20 flex items-center justify-center text-blue-500 animate-float">
                                        <i class="fa-solid fa-file-lines"></i>
                                    </div>
                                    <h2 class="text-3xl font-black text-gray-800 dark:text-white tracking-tight">Note
                                        Editor</h2>
                                </div>
                                <div class="flex items-center space-x-2 text-sm text-gray-500">
                                    <i class="fa-solid fa-circle text-green-500 text-xs animate-pulse"></i>
                                    <span>Live editing</span>
                                </div>
                            </div>

                            <div
                                class="flex space-x-2 mb-6 p-3 bg-white/60 dark:bg-black/40 rounded-2xl border border-gray-200 dark:border-gray-700/50 flex-shrink-0 shadow-sm backdrop-blur-md transition-all duration-300 hover:shadow-lg">
                                <button onclick="insertMarkdown('**', '**')"
                                    class="w-11 h-11 rounded-xl hover:bg-white dark:hover:bg-gray-700 flex items-center justify-center font-bold text-gray-600 dark:text-gray-300 transition-all duration-300 shadow-sm hover:shadow-md hover:scale-105"
                                    title="Bold">
                                    <i class="fa-solid fa-bold"></i>
                                </button>
                                <button onclick="insertMarkdown('*', '*')"
                                    class="w-11 h-11 rounded-xl hover:bg-white dark:hover:bg-gray-700 flex items-center justify-center font-bold text-gray-600 dark:text-gray-300 transition-all duration-300 shadow-sm hover:shadow-md hover:scale-105"
                                    title="Italic">
                                    <i class="fa-solid fa-italic"></i>
                                </button>
                                <div class="w-px h-6 bg-gray-300 dark:bg-gray-600 my-auto mx-2"></div>
                                <button onclick="insertMarkdown('# ', '')"
                                    class="w-11 h-11 rounded-xl hover:bg-white dark:hover:bg-gray-700 flex items-center justify-center font-bold text-gray-600 dark:text-gray-300 transition-all duration-300 shadow-sm hover:shadow-md hover:scale-105"
                                    title="Heading">
                                    <i class="fa-solid fa-heading"></i>
                                </button>
                                <button onclick="insertMarkdown('- ', '')"
                                    class="w-11 h-11 rounded-xl hover:bg-white dark:hover:bg-gray-700 flex items-center justify-center font-bold text-gray-600 dark:text-gray-300 transition-all duration-300 shadow-sm hover:shadow-md hover:scale-105"
                                    title="List">
                                    <i class="fa-solid fa-list-ul"></i>
                                </button>
                                <button onclick="insertMarkdown('`', '`')"
                                    class="w-11 h-11 rounded-xl hover:bg-white dark:hover:bg-gray-700 flex items-center justify-center font-bold text-gray-600 dark:text-gray-300 transition-all duration-300 shadow-sm hover:shadow-md hover:scale-105"
                                    title="Code">
                                    <i class="fa-solid fa-code"></i>
                                </button>
                                <div class="w-px h-6 bg-gray-300 dark:bg-gray-600 my-auto mx-2"></div>
                                <button onclick="attachFile()"
                                    class="w-11 h-11 rounded-xl hover:bg-white dark:hover:bg-gray-700 flex items-center justify-center font-bold text-gray-600 dark:text-gray-300 transition-all duration-300 shadow-sm hover:shadow-md hover:scale-105"
                                    title="Attach File">
                                    <i class="fa-solid fa-paperclip"></i>
                                </button>
                                <input type="file" id="file-input" class="hidden" multiple
                                    onchange="handleFileAttachment(event)">
                            </div>

                            <div class="relative mb-4">
                                <input type="text" id="note-title" placeholder="Untitled Document"
                                    class="bg-transparent text-4xl font-black outline-none pb-4 border-b-2 border-gray-200 dark:border-gray-700/50 focus:border-brand-500 transition-all duration-300 text-gray-800 dark:text-white w-full placeholder-gray-400 dark:placeholder-gray-500 focus:placeholder-transparent"
                                    oninput="saveNoteDraft()">
                                <div
                                    class="absolute right-2 top-1/2 -translate-y-1/2 text-[10px] font-black text-brand-500 uppercase tracking-widest animate-pulse-subtle">
                                    Click to edit title</div>
                            </div>
                            <div class="relative flex-1">
                                <textarea id="note-content" placeholder="Start capturing your thoughts..."
                                    class="bg-transparent outline-none flex-1 resize-none text-lg font-medium whitespace-pre-wrap text-gray-700 dark:text-gray-300 leading-relaxed custom-scrollbar w-full h-full placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-300 focus:placeholder-transparent"
                                    oninput="saveNoteDraft()"></textarea>
                                <div
                                    class="absolute bottom-4 right-4 text-xs text-gray-400 dark:text-gray-500 bg-gray-100 dark:bg-gray-800 px-3 py-1.5 rounded-full animate-pulse-subtle backdrop-blur-sm">
                                    Words: <span id="word-count">0</span></div>
                            </div>


                            <div id="attachments-container" class="mt-4 space-y-2"></div>

                            <div
                                class="flex justify-between items-center mt-6 pt-4 border-t-2 border-gray-200 dark:border-gray-700/50 flex-shrink-0">
                                <div class="flex items-center space-x-3">
                                    <span
                                        class="text-[11px] font-black text-gray-400 flex items-center tracking-widest uppercase"
                                        id="note-status">
                                        <div
                                            class="w-2.5 h-2.5 rounded-full bg-green-500 mr-2 shadow-[0_0_8px_rgba(34,197,94,0.8)] animate-pulse">
                                        </div>Synced
                                    </span>
                                    <span class="text-xs text-gray-500" id="last-saved">Just now</span>
                                </div>
                                <button onclick="deleteCurrentNote()"
                                    class="text-sm font-bold text-red-500 hover:bg-red-500 hover:text-white px-5 py-2.5 rounded-xl transition-all border border-red-500/20 hover:shadow-lg group">
                                    <i
                                        class="fa-solid fa-trash mr-2 group-hover:rotate-12 transition-transform"></i>Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="habits" class="view-section">
                <div class="glass-panel p-6 md:p-8 flex flex-col h-full overflow-hidden">
                    <div
                        class="flex justify-between items-end mb-8 flex-shrink-0 border-b border-gray-200 dark:border-gray-700/50 pb-6">
                        <div>
                            <h2 class="text-3xl font-black text-gray-800 dark:text-white mb-2">Daily Habits</h2>
                            <p class="font-bold text-gray-500 text-sm">Build consistency over the last 7 days.</p>
                        </div>
                        <button onclick="promptAddHabit()" class="glass-btn py-3 px-6"><i
                                class="fa-solid fa-plus mr-2"></i>New Habit</button>
                    </div>

                    <div class="flex-1 overflow-y-auto pr-2 pb-24" id="habit-list"></div>
                </div>
            </section>

            <section id="expenses" class="view-section">
                <div class="flex flex-col lg:flex-row gap-6 h-full overflow-hidden">
                    <div
                        class="w-full lg:w-[420px] flex flex-col gap-6 flex-shrink-0 overflow-y-auto pr-2 pb-24 lg:pb-0">
                        <div class="glass-panel p-6 md:p-8">
                            <h2 class="text-2xl font-black mb-6">Log Expense</h2>
                            <form onsubmit="handleAddExpense(event)" class="flex flex-col gap-4">
                                <input type="text" id="exp-desc" placeholder="What did you pay for?"
                                    class="glass-input text-lg" required autocomplete="off">
                                <div class="relative">
                                    <span
                                        class="absolute left-5 top-1/2 -translate-y-1/2 font-black text-gray-400 text-lg">$</span>
                                    <input type="number" id="exp-amount" placeholder="0.00"
                                        class="glass-input pl-9 text-lg font-black" step="0.01" min="0.01" required>
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <input type="date" id="exp-date"
                                        class="glass-input text-sm px-3 font-bold text-gray-500" required>

                                    <input type="text" id="exp-category" class="glass-input text-sm px-3 font-bold"
                                        placeholder="Category (e.g. Coffee)" required list="category-suggestions"
                                        autocomplete="off">
                                    <datalist id="category-suggestions"></datalist>
                                </div>
                                <button type="submit"
                                    class="glass-btn mt-3 shadow-orange-500/30 text-lg py-4 border border-white/20">Add
                                    to Ledger</button>
                            </form>
                        </div>
                        <div class="glass-panel p-6 md:p-8 flex flex-col items-center">
                            <h3
                                class="text-lg font-black mb-4 w-full text-left text-gray-500 uppercase tracking-widest text-[11px]">
                                Spending Profile</h3>
                            <div class="relative w-full h-56"><canvas id="expenseChart"></canvas></div>
                        </div>
                    </div>

                    <div class="glass-panel p-6 md:p-8 flex-1 flex flex-col h-full overflow-hidden relative">
                        <div
                            class="absolute top-0 right-0 w-64 h-64 bg-orange-500/10 rounded-full blur-3xl pointer-events-none">
                        </div>
                        <div
                            class="flex justify-between items-end mb-8 flex-shrink-0 z-10 border-b border-gray-200 dark:border-gray-700/50 pb-6">
                            <div>
                                <h2 class="text-3xl font-black text-gray-800 dark:text-white mb-3 tracking-tight">
                                    Transactions</h2>
                                <button onclick="setBudget()"
                                    class="text-[11px] font-black bg-gray-100 dark:bg-gray-800 text-gray-500 dark:text-gray-400 px-4 py-2 rounded-xl hover:bg-brand-500 hover:text-white transition-colors uppercase tracking-widest border border-gray-200 dark:border-gray-700 shadow-sm"
                                    id="budget-text">Set Budget: $1000</button>
                            </div>
                            <div class="text-right">
                                <p class="text-[11px] font-black text-gray-400 uppercase tracking-widest mb-1">Total</p>
                                <h3 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-red-500 tracking-tighter"
                                    id="total-expenses-display">$0.00</h3>
                            </div>
                        </div>
                        <div
                            class="w-full h-3 bg-gray-200 dark:bg-gray-800 rounded-full mb-6 overflow-hidden flex-shrink-0 shadow-inner z-10 border border-gray-300 dark:border-gray-700">
                            <div id="budget-bar" class="h-full bg-green-500 transition-all duration-700 w-0"></div>
                        </div>
                        <div class="flex-1 overflow-y-auto space-y-3 pr-2 pb-24 lg:pb-0 z-10" id="expense-list"></div>
                    </div>
                </div>
            </section>

            <section id="schedule" class="view-section">
                <div class="glass-panel p-6 md:p-8 flex-1 flex flex-col h-full overflow-hidden relative">
                    <div
                        class="flex justify-between items-center mb-6 flex-shrink-0 border-b border-gray-200/50 dark:border-gray-700/50 pb-6">
                        <div>
                            <h2 class="text-3xl font-black text-gray-800 dark:text-white tracking-tight">Timeline</h2>
                            <p class="font-bold text-brand-500 text-sm mt-1 uppercase tracking-widest text-[11px]"
                                id="schedule-date-display">Today</p>
                        </div>
                        <button onclick="openEventModal()" class="glass-btn py-3 px-6"><i
                                class="fa-solid fa-plus mr-2"></i>Add Block</button>
                    </div>
                    <div class="flex-1 overflow-y-auto relative rounded-[2rem] bg-white/40 dark:bg-black/20 border border-gray-200 dark:border-gray-700/50 shadow-inner"
                        id="timeline-scroll">
                        <div class="timeline-wrapper" id="timeline-grid">
                        </div>
                        <div id="current-time-line"
                            class="absolute left-0 right-0 h-[2.5px] bg-red-500 z-20 pointer-events-none hidden shadow-[0_0_12px_rgba(239,68,68,0.9)]">
                            <div
                                class="absolute -left-1.5 -top-2 w-4 h-4 rounded-full bg-red-500 shadow-[0_0_10px_rgba(239,68,68,1)] border-2 border-white dark:border-gray-900">
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="analytics" class="view-section">
                <div class="glass-panel p-6 md:p-8 flex flex-col h-full overflow-hidden">
                    <div class="flex-1 overflow-y-auto pr-2 pb-6">
                        <div
                            class="flex justify-between items-center mb-8 flex-shrink-0 border-b border-gray-200/50 dark:border-gray-700/50 pb-6">
                            <h2
                                class="text-3xl font-black text-gray-800 dark:text-white tracking-tight animate-fade-in">
                                Productivity Analytics</h2>
                            <div class="flex space-x-3">
                                <select id="analytics-period" class="glass-input md:w-40 text-sm font-bold"
                                    onchange="updateAnalytics()">
                                    <option value="7">Last 7 Days</option>
                                    <option value="30" selected>Last 30 Days</option>
                                    <option value="90">Last 90 Days</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="bento-card p-6 text-center card-hover">
                                <div class="text-3xl font-black text-brand-500 mb-2" id="total-tasks-completed">0</div>
                                <div class="text-sm font-bold text-gray-500 uppercase tracking-widest">Tasks Completed
                                </div>
                            </div>
                            <div class="bento-card p-6 text-center card-hover">
                                <div class="text-3xl font-black text-green-500 mb-2" id="habits-streak">0</div>
                                <div class="text-sm font-bold text-gray-500 uppercase tracking-widest">Current Streak
                                </div>
                            </div>
                            <div class="bento-card p-6 text-center card-hover">
                                <div class="text-3xl font-black text-purple-500 mb-2" id="total-expenses-analytics">$0
                                </div>
                                <div class="text-sm font-bold text-gray-500 uppercase tracking-widest">Total Expenses
                                </div>
                            </div>
                            <div class="bento-card p-6 text-center card-hover">
                                <div class="text-3xl font-black text-orange-500 mb-2" id="focus-hours">0h</div>
                                <div class="text-sm font-bold text-gray-500 uppercase tracking-widest">Focus Time</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 flex-1">
                            <div class="bento-card p-6 card-hover">
                                <h3 class="text-xl font-black mb-4">Task Completion Rate</h3>
                                <div class="relative w-full h-64">
                                    <canvas id="completionChart"></canvas>
                                </div>
                            </div>

                            <div class="bento-card p-6 card-hover">
                                <h3 class="text-xl font-black mb-4">Productivity Trends</h3>
                                <div class="relative w-full h-64">
                                    <canvas id="productivityChart"></canvas>
                                </div>
                            </div>

                            <div class="bento-card p-6 card-hover">
                                <h3 class="text-xl font-black mb-4">Mood Tracking</h3>
                                <div class="relative w-full h-64">
                                    <canvas id="moodChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 bento-card p-6 card-hover">
                            <h3 class="text-xl font-black mb-4">Weekly Overview</h3>
                            <div class="grid grid-cols-7 gap-2">
                                <div class="text-center">
                                    <div class="text-xs font-bold text-gray-500 mb-2">Mon</div>
                                    <div class="w-full h-32 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-end p-1">
                                        <div class="w-full bg-brand-500 rounded-t-lg" style="height: 70%"
                                            id="mon-activity"></div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs font-bold text-gray-500 mb-2">Tue</div>
                                    <div class="w-full h-32 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-end p-1">
                                        <div class="w-full bg-brand-500 rounded-t-lg" style="height: 45%"
                                            id="tue-activity"></div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs font-bold text-gray-500 mb-2">Wed</div>
                                    <div class="w-full h-32 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-end p-1">
                                        <div class="w-full bg-brand-500 rounded-t-lg" style="height: 85%"
                                            id="wed-activity"></div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs font-bold text-gray-500 mb-2">Thu</div>
                                    <div class="w-full h-32 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-end p-1">
                                        <div class="w-full bg-brand-500 rounded-t-lg" style="height: 60%"
                                            id="thu-activity"></div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs font-bold text-gray-500 mb-2">Fri</div>
                                    <div class="w-full h-32 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-end p-1">
                                        <div class="w-full bg-brand-500 rounded-t-lg" style="height: 90%"
                                            id="fri-activity"></div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs font-bold text-gray-500 mb-2">Sat</div>
                                    <div class="w-full h-32 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-end p-1">
                                        <div class="w-full bg-brand-500 rounded-t-lg" style="height: 30%"
                                            id="sat-activity"></div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs font-bold text-gray-500 mb-2">Sun</div>
                                    <div class="w-full h-32 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-end p-1">
                                        <div class="w-full bg-brand-500 rounded-t-lg" style="height: 55%"
                                            id="sun-activity"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>


        </div>
    </main>

    <div id="cmdk-modal"
        class="fixed inset-0 bg-gray-900/60 backdrop-blur-md z-[70] hidden flex-col items-center pt-[15vh] px-4 opacity-0 transition-opacity duration-200">
        <div class="w-full max-w-2xl bg-white/90 dark:bg-gray-900/90 backdrop-blur-2xl rounded-[2rem] shadow-2xl border border-white dark:border-gray-700 overflow-hidden transform scale-95 transition-transform duration-200"
            id="cmdk-content">
            <div class="p-5 border-b border-gray-200 dark:border-gray-800 flex items-center space-x-4">
                <i class="fa-solid fa-magnifying-glass text-2xl text-brand-500"></i>
                <input type="text" id="cmdk-input" placeholder="Search tasks, notes, events..."
                    class="flex-1 bg-transparent text-xl font-black outline-none text-gray-800 dark:text-white"
                    oninput="handleGlobalSearch()" autocomplete="off">
                <kbd
                    class="hidden sm:inline-block border-none bg-gray-100 dark:bg-gray-800 px-3 py-1.5 rounded-xl">ESC</kbd>
            </div>
            <div class="max-h-[50vh] overflow-y-auto p-3 custom-scrollbar" id="cmdk-results"></div>
        </div>
    </div>

    <div id="pomodoro-widget"
        class="fixed top-24 right-8 z-[60] glass-panel p-6 rounded-[2.5rem] w-80 shadow-2xl border border-brand-500/30 hidden transform transition-all cursor-grab active:cursor-grabbing">
        <div class="flex justify-between items-center mb-5">
            <h3 class="font-black text-xs flex items-center uppercase tracking-widest text-gray-500 dark:text-gray-400">
                <i class="fa-solid fa-stopwatch mr-2 text-brand-500 text-base"></i>Focus Timer
            </h3>
            <button onclick="togglePomodoro()"
                class="text-gray-400 hover:text-red-500 transition-colors w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center"><i
                    class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="text-center mb-8 relative">
            <div class="absolute inset-0 bg-brand-500/10 rounded-full blur-2xl pointer-events-none"></div>
            <div class="text-[5rem] leading-none font-black tracking-tighter font-mono text-gray-800 dark:text-white relative z-10 drop-shadow-sm"
                id="pomo-display">25:00</div>
            <p class="text-[10px] font-black uppercase mt-4 text-brand-500 tracking-widest relative z-10 bg-brand-500/10 inline-block px-4 py-1.5 rounded-xl border border-brand-500/20"
                id="pomo-mode">Deep Work</p>
        </div>
        <div class="flex justify-center space-x-4">
            <button onclick="startPomodoro()"
                class="bg-brand-500 hover:bg-brand-600 hover:scale-110 text-white w-16 h-16 rounded-2xl flex justify-center items-center transition-all shadow-xl shadow-brand-500/40 text-2xl border border-white/20"><i
                    class="fa-solid fa-play" id="pomo-play-icon"></i></button>
            <button onclick="resetPomodoro()"
                class="bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white w-16 h-16 rounded-2xl flex justify-center items-center transition-colors text-xl"><i
                    class="fa-solid fa-rotate-right"></i></button>
            <button onclick="switchPomodoroMode()"
                class="bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white w-16 h-16 rounded-2xl flex justify-center items-center transition-colors text-sm font-black uppercase"><i
                    class="fa-solid fa-forward-step"></i></button>
        </div>
    </div>

    <div id="event-modal"
        class="fixed inset-0 bg-gray-900/60 backdrop-blur-md z-[60] hidden flex items-center justify-center p-4">
        <div class="glass-panel p-8 w-full max-w-sm scale-95 opacity-0 transition-all duration-300"
            id="event-modal-content">
            <div
                class="flex justify-between items-center mb-6 border-b border-gray-200/50 dark:border-gray-700/50 pb-4">
                <h3 class="text-2xl font-black">Block Time</h3><button onclick="closeEventModal()"
                    class="text-gray-400 hover:text-white bg-gray-100 dark:bg-gray-800 w-8 h-8 rounded-full"><i
                        class="fa-solid fa-xmark"></i></button>
            </div>
            <form onsubmit="handleSaveEvent(event)" class="flex flex-col gap-5">
                <input type="text" id="ev-title" class="glass-input font-bold" placeholder="E.g., Deep Work Session"
                    required>
                <div class="grid grid-cols-2 gap-4">
                    <div><label
                            class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-1 block">Start</label><input
                            type="time" id="ev-start" class="glass-input font-bold px-3 text-sm" required></div>
                    <div><label
                            class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-1 block">End</label><input
                            type="time" id="ev-end" class="glass-input font-bold px-3 text-sm" required></div>
                </div>
                <div>
                    <label class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-2 block">Tag
                        Color</label>
                    <div class="flex space-x-3">
                        <label class="cursor-pointer relative"><input type="radio" name="evcolor" value="bg-brand-500"
                                class="peer sr-only" checked>
                            <div
                                class="w-8 h-8 rounded-full bg-brand-500 peer-checked:ring-4 ring-offset-2 ring-offset-white dark:ring-offset-gray-900 ring-brand-500 transition-all">
                            </div>
                        </label>
                        <label class="cursor-pointer relative"><input type="radio" name="evcolor" value="bg-pink-500"
                                class="peer sr-only">
                            <div
                                class="w-8 h-8 rounded-full bg-pink-500 peer-checked:ring-4 ring-offset-2 ring-offset-white dark:ring-offset-gray-900 ring-pink-500 transition-all">
                            </div>
                        </label>
                        <label class="cursor-pointer relative"><input type="radio" name="evcolor" value="bg-green-500"
                                class="peer sr-only">
                            <div
                                class="w-8 h-8 rounded-full bg-green-500 peer-checked:ring-4 ring-offset-2 ring-offset-white dark:ring-offset-gray-900 ring-green-500 transition-all">
                            </div>
                        </label>
                        <label class="cursor-pointer relative"><input type="radio" name="evcolor" value="bg-orange-500"
                                class="peer sr-only">
                            <div
                                class="w-8 h-8 rounded-full bg-orange-500 peer-checked:ring-4 ring-offset-2 ring-offset-white dark:ring-offset-gray-900 ring-orange-500 transition-all">
                            </div>
                        </label>
                    </div>
                </div>
                <button type="submit" class="glass-btn py-3.5 mt-2 text-lg">Save to Timeline</button>
            </form>
        </div>
    </div>


    <div id="advanced-task-modal"
        class="fixed inset-0 bg-gray-900/60 backdrop-blur-md z-[60] hidden flex items-center justify-center p-4">
        <div class="glass-panel p-8 w-full max-w-2xl scale-95 opacity-0 transition-all duration-300"
            id="advanced-task-content">
            <div
                class="flex justify-between items-center mb-6 border-b border-gray-200/50 dark:border-gray-700/50 pb-4">
                <h3 class="text-2xl font-black">Advanced Task</h3>
                <button onclick="closeAdvancedTaskModal()"
                    class="text-gray-400 hover:text-white bg-gray-100 dark:bg-gray-800 w-8 h-8 rounded-full">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <form onsubmit="handleAdvancedTask(event)" class="flex flex-col gap-5">
                <input type="text" id="adv-task-title" class="glass-input font-bold" placeholder="Task title" required>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-1 block">Due
                            Date</label>
                        <input type="date" id="adv-task-date" class="glass-input font-bold px-3 text-sm">
                    </div>
                    <div>
                        <label
                            class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-1 block">Priority</label>
                        <select id="adv-task-priority" class="glass-input font-bold text-sm">
                            <option value="low">üîΩ Low</option>
                            <option value="medium" selected>‚è∫Ô∏è Medium</option>
                            <option value="high">üîº High</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label
                        class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-2 block">Description</label>
                    <textarea id="adv-task-desc" class="glass-input font-medium h-24"
                        placeholder="Task description..."></textarea>
                </div>


                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-[10px] font-black text-gray-500 uppercase tracking-widest">Subtasks</label>
                        <button type="button" onclick="addSubtask()"
                            class="text-brand-500 hover:text-brand-600 text-sm font-bold">
                            <i class="fa-solid fa-plus mr-1"></i>Add Subtask
                        </button>
                    </div>
                    <div id="subtasks-container" class="space-y-2"></div>
                </div>


                <div
                    class="bg-gray-100/50 dark:bg-gray-800/50 p-4 rounded-2xl border border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center justify-between mb-3">
                        <label class="text-[10px] font-black text-gray-500 uppercase tracking-widest">Recurring
                            Task</label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="recurring-toggle" class="sr-only peer">
                            <div
                                class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-500">
                            </div>
                        </label>
                    </div>
                    <div id="recurring-options" class="hidden space-y-3">
                        <select id="recurring-frequency" class="glass-input font-bold text-sm">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                        <div>
                            <label
                                class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-1 block">Ends
                                After</label>
                            <input type="number" id="recurring-count" class="glass-input font-bold px-3 text-sm"
                                placeholder="Number of occurrences" min="1" value="10">
                        </div>
                    </div>
                </div>

                <button type="submit" class="glass-btn py-3.5 mt-2 text-lg">Create Advanced Task</button>
            </form>
        </div>
    </div>



    <div id="settings-modal"
        class="fixed inset-0 bg-gray-900/60 backdrop-blur-md z-[60] hidden flex items-center justify-center p-4">
        <div class="glass-panel p-8 w-full max-w-md scale-95 opacity-0 transition-all duration-300 shadow-2xl"
            id="settings-modal-content">
            <div
                class="flex justify-between items-center mb-6 border-b border-gray-200/50 dark:border-gray-700/50 pb-4">
                <h3 class="text-2xl font-black"><i class="fa-solid fa-sliders text-brand-500 mr-3"></i>Preferences</h3>
                <button onclick="closeSettings()"
                    class="text-gray-400 hover:text-white bg-gray-100 dark:bg-gray-800 w-8 h-8 rounded-full flex items-center justify-center transition-colors"><i
                        class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="space-y-6">
                <div>
                    <label class="block text-[10px] font-black uppercase tracking-widest text-gray-500 mb-2">Accent
                        Color</label>
                    <div class="flex space-x-3">
                        <button onclick="changeTheme('indigo')"
                            class="w-10 h-10 rounded-full bg-indigo-500 hover:scale-110 transition-transform shadow-lg ring-2 ring-offset-2 ring-offset-white dark:ring-offset-gray-900 ring-white focus:ring-indigo-500"></button>
                        <button onclick="changeTheme('rose')"
                            class="w-10 h-10 rounded-full bg-rose-500 hover:scale-110 transition-transform shadow-lg ring-2 ring-offset-2 ring-offset-white dark:ring-offset-gray-900 ring-white focus:ring-rose-500"></button>
                        <button onclick="changeTheme('emerald')"
                            class="w-10 h-10 rounded-full bg-emerald-500 hover:scale-110 transition-transform shadow-lg ring-2 ring-offset-2 ring-offset-white dark:ring-offset-gray-900 ring-white focus:ring-emerald-500"></button>
                        <button onclick="changeTheme('amber')"
                            class="w-10 h-10 rounded-full bg-amber-500 hover:scale-110 transition-transform shadow-lg ring-2 ring-offset-2 ring-offset-white dark:ring-offset-gray-900 ring-white focus:ring-amber-500"></button>
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] font-black uppercase tracking-widest text-gray-500 mb-2">Display
                        Name</label>
                    <div class="flex gap-2">
                        <input type="text" id="setting-name" class="glass-input py-3 font-bold" placeholder="Your Name">
                        <button onclick="saveName()"
                            class="bg-gray-800 dark:bg-white text-white dark:text-gray-900 font-bold px-5 rounded-2xl hover:-translate-y-1 transition-transform shadow-md">Save</button>
                    </div>
                </div>
                <div
                    class="bg-gray-100/50 dark:bg-gray-800/50 p-5 rounded-3xl border border-gray-200 dark:border-gray-700">
                    <h4 class="text-sm font-black mb-1">Data Backup</h4>
                    <p class="text-xs font-bold text-gray-500 mb-4">Export to JSON or restore a backup.</p>
                    <div class="flex gap-3">
                        <button onclick="exportAllData()"
                            class="flex-1 bg-brand-500 hover:bg-brand-600 text-white py-3 rounded-2xl font-bold transition-colors text-sm shadow-md border border-white/20"><i
                                class="fa-solid fa-download mr-2"></i>Export</button>
                        <label
                            class="flex-1 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 text-gray-800 dark:text-white text-center py-3 rounded-2xl font-bold transition-colors cursor-pointer text-sm shadow-sm border border-gray-200 dark:border-gray-600">
                            <i class="fa-solid fa-upload mr-2"></i>Import<input type="file" class="hidden"
                                accept=".json" onchange="importAllData(event)">
                        </label>
                    </div>
                </div>
                <button onclick="factoryReset()"
                    class="w-full text-red-500 font-black hover:bg-red-500/10 py-3.5 rounded-2xl transition-colors border-2 border-red-500/20"><i
                        class="fa-solid fa-triangle-exclamation mr-2"></i>WIPE ALL DATA</button>
            </div>
        </div>
    </div>

    <div id="toast-container"
        class="fixed bottom-8 right-1/2 translate-x-1/2 z-[80] flex flex-col space-y-3 pointer-events-none" role="alert"
        aria-live="polite"></div>

    <!-- Loading Screen -->
    <div id="loading-screen"
        class="fixed inset-0 bg-white dark:bg-gray-900 z-[100] flex items-center justify-center transition-opacity duration-500">
        <div class="text-center">
            <div
                class="w-16 h-16 border-4 border-brand-500 border-t-transparent rounded-full animate-spin mx-auto mb-4">
            </div>
            <h2 class="text-2xl font-black text-gray-800 dark:text-white mb-2">FocusSphere</h2>
            <p class="text-gray-500 dark:text-gray-400">Loading your productivity suite...</p>
        </div>
    </div>

    <script>

        const Storage = {
            get: (key) => {
                try {
                    const item = localStorage.getItem(`focussphere_${key}`);
                    return item ? JSON.parse(item) : [];
                } catch (e) {
                    console.error(`Error getting ${key} from storage:`, e);
                    return [];
                }
            },
            set: (key, data) => {
                try {
                    if (typeof data === 'undefined' || data === null) {
                        console.warn(`Attempted to store invalid data for key: ${key}`);
                        return false;
                    }
                    localStorage.setItem(`focussphere_${key}`, JSON.stringify(data));
                    return true;
                } catch (e) {
                    console.error(`Error setting ${key} in storage:`, e);
                    return false;
                }
            },
            getSettings: () => {
                try {
                    const item = localStorage.getItem('focussphere_settings');
                    return item ? JSON.parse(item) : { budget: 1000, name: 'Creator', theme: 'indigo' };
                } catch (e) {
                    console.error('Error getting settings from storage:', e);
                    return { budget: 1000, name: 'Creator', theme: 'indigo' };
                }
            },
            setSettings: (data) => {
                try {
                    if (typeof data === 'undefined' || data === null) {
                        console.warn('Attempted to store invalid settings data');
                        return false;
                    }
                    localStorage.setItem('focussphere_settings', JSON.stringify(data));
                    return true;
                } catch (e) {
                    console.error('Error setting settings in storage:', e);
                    return false;
                }
            },
            init: function () {
                try {
                    ['tasks', 'notes', 'expenses', 'events', 'habits'].forEach(k => {
                        if (!localStorage.getItem(`focussphere_${k}`)) this.set(k, []);
                    });
                    if (!localStorage.getItem('focussphere_settings')) this.setSettings({ budget: 1000, name: 'Creator', theme: 'indigo' });
                } catch (e) {
                    console.error('Error initializing storage:', e);
                }
            }
        };
        Storage.init();

        const ThemeColors = {
            'indigo': { 400: '#6366f1', 500: '#4f46e5', 600: '#4338ca', rgb: '79, 70, 202' },
            'rose': { 400: '#f43f5e', 500: '#e11d48', 600: '#be123c', rgb: '225, 29, 72' },
            'emerald': { 400: '#10b981', 500: '#059669', 600: '#047857', rgb: '4, 120, 87' },
            'amber': { 400: '#f59e0b', 500: '#d97706', 600: '#b45309', rgb: '180, 83, 9' }
        };

        function changeTheme(colorName) {
            const colors = ThemeColors[colorName];
            if (!colors) return;
            const root = document.documentElement;
            root.style.setProperty('--brand-400', colors[400]);
            root.style.setProperty('--brand-500', colors[500]);
            root.style.setProperty('--brand-600', colors[600]);
            root.style.setProperty('--brand-rgb', colors.rgb);

            const s = Storage.getSettings(); s.theme = colorName; Storage.setSettings(s);
            if (mainChartInstance) initMainChart(); // redraw chart with new colors
        }


        const DOM_CACHE = {
            toastContainer: null,
            greeting: null,
            currentDate: null,
            scheduleDateDisplay: null,
            taskInput: null,
            taskDate: null,
            taskPriority: null,
            sidebar: null,
            mobileOverlay: null,


            init: function () {
                try {
                    this.toastContainer = document.getElementById('toast-container');
                    this.greeting = document.getElementById('greeting');
                    this.currentDate = document.getElementById('current-date');
                    this.scheduleDateDisplay = document.getElementById('schedule-date-display');
                    this.taskInput = document.getElementById('task-input');
                    this.taskDate = document.getElementById('task-date');
                    this.taskPriority = document.getElementById('task-priority');
                    this.sidebar = document.getElementById('sidebar');
                    this.mobileOverlay = document.getElementById('mobile-overlay');


                    Object.keys(this).forEach(key => {
                        if (key !== 'init' && key !== 'get' && this[key] === null) {
                            console.warn(`DOM element not found: ${key}`);
                        }
                    });
                } catch (error) {
                    console.error('Error initializing DOM cache:', error);
                }
            },


            get: function (elementName) {
                if (this[elementName]) {
                    return this[elementName];
                }


                const element = document.getElementById(elementName);
                if (element) {
                    this[elementName] = element;
                    return element;
                }

                console.warn(`Element not found: ${elementName}`);
                return null;
            }
        };


        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => DOM_CACHE.init());
        } else {
            DOM_CACHE.init();
        }

        let currentNoteId = null; let saveTimeout = null; let expenseChartInstance = null; let mainChartInstance = null;
        let pomoTime = 25 * 60, pomoInterval = null, isPomoRunning = false, pomoMode = 'work';
        let musicPlayer = null; let isMusicPlaying = false; let currentTrack = 0;
        let quoteInterval = null;


        function showToast(msg, type = 'success') {
            try {
                const toast = document.createElement('div');
                if (!toast) return;

                const color = type === 'success' ? 'bg-gradient-to-r from-brand-500 to-brand-600 text-white border-brand-500/30' : 'bg-gradient-to-r from-red-500 to-red-600 text-white border-red-600/30';
                const icon = type === 'success' ? '<i class="fa-solid fa-circle-check text-white text-lg"></i>' : '<i class="fa-solid fa-triangle-exclamation text-white text-lg"></i>';
                toast.className = `px-6 py-4 rounded-[1.25rem] shadow-[0_10px_40px_rgba(0,0,0,0.2)] flex items-center space-x-3 font-bold text-sm pointer-events-auto transform transition-all duration-300 translate-y-12 opacity-0 border ${color}`;
                toast.innerHTML = `${icon}<span>${msg}</span>`;

                const container = DOM_CACHE.get('toastContainer');
                if (!container) {
                    console.error('Toast container not found');
                    return;
                }

                container.appendChild(toast);

                requestAnimationFrame(() => {
                    if (toast) toast.classList.remove('translate-y-12', 'opacity-0');
                });
                setTimeout(() => {
                    if (toast) {
                        toast.classList.add('translate-y-12', 'opacity-0');
                        setTimeout(() => {
                            if (toast && toast.parentNode) toast.remove();
                        }, 300);
                    }
                }, 3000);
            } catch (error) {
                console.error('Error showing toast:', error);
            }
        }

        function triggerConfetti() {
            const s = Storage.getSettings();
            const theme = s.theme || 'indigo';
            const themeObj = ThemeColors[theme];
            const rgb = themeObj['500'];
            confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 }, colors: [rgb, '#ec4899', '#10b981', '#f59e0b'], disableForReducedMotion: true });
        }

        function updateDateTime() {
            try {
                const now = new Date();
                const hour = now.getHours();
                const name = Storage.getSettings().name || 'Creator';

                const greetingElement = DOM_CACHE.get('greeting');
                if (greetingElement) {
                    greetingElement.innerText = `Good ${hour < 12 ? 'Morning' : hour < 18 ? 'Afternoon' : 'Evening'}, ${name}!`;
                }

                const dateStr = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

                const currentDateElement = DOM_CACHE.get('currentDate');
                if (currentDateElement) {
                    currentDateElement.innerText = dateStr;
                }

                const scheduleElement = document.getElementById('schedule');
                if (scheduleElement && scheduleElement.classList.contains('active')) {
                    const scheduleDateElement = DOM_CACHE.get('scheduleDateDisplay');
                    if (scheduleDateElement) {
                        scheduleDateElement.innerText = dateStr;
                    }
                }
            } catch (error) {
                console.error('Error updating datetime:', error);
            }
        }


        async function refreshWeather() {
            try {

                const conditions = [
                    { temp: '72¬∞F', desc: 'Sunny', icon: '‚òÄÔ∏è' },
                    { temp: '68¬∞F', desc: 'Partly Cloudy', icon: '‚õÖ' },
                    { temp: '65¬∞F', desc: 'Cloudy', icon: '‚òÅÔ∏è' },
                    { temp: '70¬∞F', desc: 'Clear', icon: 'üå§Ô∏è' }
                ];
                const randomCondition = conditions[Math.floor(Math.random() * conditions.length)];

                document.getElementById('weather-temp').innerText = randomCondition.temp;
                document.getElementById('weather-desc').innerText = randomCondition.desc;
                document.getElementById('weather-icon').innerText = randomCondition.icon;

                showToast('Weather updated!');
            } catch (error) {
                console.error('Weather error:', error);
                document.getElementById('weather-temp').innerText = '72¬∞F';
                document.getElementById('weather-desc').innerText = 'Sunny';
                document.getElementById('weather-icon').innerText = '‚òÄÔ∏è';
            }
        }


        function logMood(mood, btn) {

            document.querySelectorAll('.mood-btn').forEach(b => {
                b.classList.add('grayscale', 'opacity-70');
                b.classList.remove('grayscale-0', 'scale-125', 'opacity-100');
            });


            btn.classList.remove('grayscale', 'opacity-70');
            btn.classList.add('grayscale-0', 'scale-125', 'opacity-100');


            const moodData = Storage.get('moods') || [];
            moodData.push({
                mood: mood,
                timestamp: Date.now(),
                date: new Date().toISOString().split('T')[0]
            });
            Storage.set('moods', moodData);

            showToast(`Mood logged: ${mood}!`);
        }


        function attachFile() {
            document.getElementById('file-input').click();
        }

        function handleFileAttachment(event) {
            const files = Array.from(event.target.files);
            if (!currentNoteId) return;

            const notes = Storage.get('notes');
            const noteIndex = notes.findIndex(n => n.id === currentNoteId);
            if (noteIndex === -1) return;

            if (!notes[noteIndex].attachments) {
                notes[noteIndex].attachments = [];
            }

            files.forEach(file => {
                const fileData = {
                    id: Date.now() + Math.random(),
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    lastModified: file.lastModified
                };
                notes[noteIndex].attachments.push(fileData);
            });

            Storage.set('notes', notes);
            renderAttachments(notes[noteIndex].attachments);
            showToast(`${files.length} file(s) attached`);
        }

        function renderAttachments(attachments) {
            const container = document.getElementById('attachments-container');
            if (!attachments || attachments.length === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = attachments.map(file => `
                <div class="file-attachment">
                    <div class="flex items-center flex-1">
                        <i class="fa-solid fa-file mr-3 text-brand-500"></i>
                        <div class="flex-1 min-w-0">
                            <div class="font-bold text-gray-800 dark:text-gray-200 truncate">${file.name}</div>
                            <div class="text-xs text-gray-500">${(file.size / 1024).toFixed(1)} KB</div>
                        </div>
                    </div>
                    <button onclick="removeAttachment(${file.id})" class="text-red-500 hover:text-red-700 ml-2">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        function removeAttachment(fileId) {
            if (!currentNoteId) return;

            const notes = Storage.get('notes');
            const noteIndex = notes.findIndex(n => n.id === currentNoteId);
            if (noteIndex === -1) return;

            notes[noteIndex].attachments = notes[noteIndex].attachments.filter(f => f.id !== fileId);
            Storage.set('notes', notes);
            renderAttachments(notes[noteIndex].attachments);
            showToast('File removed');
        }


        const motivationalQuotes = [
            "The secret of getting ahead is getting started. - Mark Twain",
            "It always seems impossible until it's done. - Nelson Mandela",
            "The best way to predict the future is to create it. - Peter Drucker",
            "Don't watch the clock; do what it does. Keep going. - Sam Levenson",
            "The only way to do great work is to love what you do. - Steve Jobs",
            "Success is not final, failure is not fatal. - Winston Churchill",
            "The future belongs to those who believe in the beauty of their dreams. - Eleanor Roosevelt",
            "Action is the foundational key to all success. - Pablo Picasso"
        ];

        function updateQuote() {
            const randomQuote = motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];
            document.getElementById('quote-text').innerText = `"${randomQuote}"`;
        }

        function startQuoteRotation() {
            quoteInterval = setInterval(updateQuote, 30000);
        }


        function navigate(targetId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(targetId).classList.add('active');

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.querySelector('div').className = "w-9 h-9 rounded-xl bg-gray-100 dark:bg-black/30 flex items-center justify-center group-hover:scale-110 transition-all text-gray-500 dark:text-gray-400";

                if (btn.dataset.target === targetId) {
                    btn.classList.add('active');
                    btn.querySelector('div').className = `w-9 h-9 rounded-xl flex items-center justify-center scale-110 transition-all bg-brand-500/10 text-brand-500`;
                }
            });
            if (window.innerWidth < 768) { const sidebar = document.getElementById('sidebar'); if (!sidebar.classList.contains('-translate-x-[120%]')) toggleSidebar(); }

            if (targetId === 'dashboard') { updateDashboardStats(); initMainChart(); }
            if (targetId === 'tasks') renderTasks();
            if (targetId === 'notes') renderNotes();
            if (targetId === 'expenses') { renderExpenses(); initExpenseChart(); }
            if (targetId === 'schedule') renderSchedule();
            if (targetId === 'habits') renderHabits();
            if (targetId === 'analytics') { updateAnalytics(); initAnalyticsCharts(); renderTasks(); }

        }

        function toggleSidebar() {
            try {
                const sidebar = DOM_CACHE.get('sidebar');
                const overlay = DOM_CACHE.get('mobileOverlay');

                if (sidebar) sidebar.classList.toggle('-translate-x-[120%]');
                if (overlay) overlay.classList.toggle('hidden');
            } catch (error) {
                console.error('Error toggling sidebar:', error);
            }
        }


        function handleAddTask(e) {
            try {
                e.preventDefault();


                const titleInput = document.getElementById('task-input');
                const dueInput = document.getElementById('task-date');
                const priorityInput = document.getElementById('task-priority');

                if (!titleInput) {
                    showToast('Task title input not found', 'error');
                    return;
                }

                const title = titleInput.value.trim();
                if (!title) {
                    showToast('Please enter a task title', 'error');
                    titleInput.focus();
                    return;
                }


                let dueDate = null;
                if (dueInput && dueInput.value) {
                    const date = new Date(dueInput.value);
                    if (isNaN(date.getTime())) {
                        showToast('Invalid due date', 'error');
                        dueInput.focus();
                        return;
                    }
                    dueDate = dueInput.value;
                }


                let priority = 'medium';
                if (priorityInput && priorityInput.value) {
                    priority = priorityInput.value;
                }


                const tagRegex = /#(\w+)/g;
                const tags = [];
                let match;
                while ((match = tagRegex.exec(title)) !== null) {
                    tags.push(match[1]);
                }


                const cleanTitle = title.replace(/#\w+/g, '').trim();

                const tasks = Storage.get('tasks');
                const newTask = {
                    id: Date.now(),
                    title: cleanTitle,
                    dueDate,
                    tags,
                    priority,
                    completed: false,
                    createdAt: new Date().toISOString()
                };

                tasks.push(newTask);
                if (Storage.set('tasks', tasks)) {
                    renderTasks();
                    updateDashboardStats();
                    showToast('Task added successfully!');


                    titleInput.value = '';
                    if (dueInput) dueInput.value = '';
                    if (priorityInput) priorityInput.value = 'medium';
                    titleInput.focus();
                } else {
                    showToast('Failed to save task', 'error');
                }
            } catch (error) {
                console.error('Error adding task:', error);
                showToast('Failed to add task', 'error');
            }
        }
        function toggleTheme() {
            document.documentElement.classList.toggle('dark'); const isDark = document.documentElement.classList.contains('dark');
            document.getElementById('theme-icon').className = `fa-solid fa-${isDark ? 'moon' : 'sun'}`;
            document.getElementById('theme-text').innerText = isDark ? 'Dark Mode' : 'Light Mode';
            if (mainChartInstance) mainChartInstance.update(); if (expenseChartInstance) expenseChartInstance.update();
        }


        document.addEventListener('keydown', (e) => {

            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                openSearchModal();
            }

            if (e.key === 'Escape') {
                closeSearchModal();
                closeAdvancedTaskModal();
                closeEventModal();
                closeSettings();
            }

            if ((e.ctrlKey || e.metaKey) && e.key >= '1' && e.key <= '8') {
                e.preventDefault();
                const navButtons = document.querySelectorAll('.nav-btn');
                const index = parseInt(e.key) - 1;
                if (navButtons[index]) {
                    navButtons[index].click();
                }
            }

            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                if (document.getElementById('tasks').classList.contains('active')) {
                    document.getElementById('task-input').focus();
                }
            }

            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                if (document.getElementById('dashboard').classList.contains('active')) {
                    document.getElementById('scratchpad-input').focus();
                }
            }
        });
        function openSearchModal() {
            const modal = document.getElementById('cmdk-modal'); const content = document.getElementById('cmdk-content');
            modal.classList.remove('hidden'); modal.classList.add('flex');
            setTimeout(() => { modal.classList.remove('opacity-0'); content.classList.remove('scale-95'); document.getElementById('cmdk-input').focus(); }, 10);
            handleGlobalSearch();
        }
        function closeSearchModal() {
            const modal = document.getElementById('cmdk-modal'); const content = document.getElementById('cmdk-content');
            modal.classList.add('opacity-0'); content.classList.add('scale-95');
            setTimeout(() => { modal.classList.add('hidden'); modal.classList.remove('flex'); document.getElementById('cmdk-input').value = ''; }, 200);
        }
        function handleGlobalSearch() {
            const q = document.getElementById('cmdk-input').value.toLowerCase(); const container = document.getElementById('cmdk-results');
            if (!q) { container.innerHTML = '<div class="p-10 text-center text-gray-400 font-bold"><p>What are you looking for?</p></div>'; return; }

            const tasks = Storage.get('tasks').filter(t => t.title.toLowerCase().includes(q));
            const notes = Storage.get('notes').filter(n => (n.title && n.title.toLowerCase().includes(q)) || (n.content && n.content.toLowerCase().includes(q)));

            let html = '';
            if (tasks.length) html += `<div class="text-[10px] font-black uppercase tracking-widest text-gray-400 px-4 py-2 mt-2">Tasks</div>` + tasks.map(t => `<div onclick="closeSearchModal(); navigate('tasks');" class="p-4 mx-2 rounded-2xl hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer flex items-center space-x-4 transition-colors group"><div class="w-8 h-8 rounded-lg bg-green-500/10 flex items-center justify-center"><i class="fa-solid fa-check text-green-500"></i></div><span class="font-bold flex-1 text-gray-800 dark:text-gray-200 group-hover:text-brand-500 transition-colors">${t.title}</span></div>`).join('');
            if (notes.length) html += `<div class="text-[10px] font-black uppercase tracking-widest text-gray-400 px-4 py-2 mt-4">Notes</div>` + notes.map(n => `<div onclick="closeSearchModal(); navigate('notes'); openNote(${n.id});" class="p-4 mx-2 rounded-2xl hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer flex items-center space-x-4 transition-colors group"><div class="w-8 h-8 rounded-lg bg-pink-500/10 flex items-center justify-center"><i class="fa-solid fa-pen-nib text-pink-500"></i></div><span class="font-bold flex-1 text-gray-800 dark:text-gray-200 group-hover:text-brand-500 transition-colors">${n.title || 'Untitled Note'}</span></div>`).join('');
            if (!html) html = '<div class="p-10 text-center text-gray-500 font-bold"><p>No results found.</p></div>'; container.innerHTML = html;
        }


        function togglePomodoro() { const w = document.getElementById('pomodoro-widget'); w.classList.toggle('hidden'); if (!w.classList.contains('hidden')) updatePomoDisplay(); }
        function updatePomoDisplay() { const m = Math.floor(pomoTime / 60).toString().padStart(2, '0'); const s = (pomoTime % 60).toString().padStart(2, '0'); document.getElementById('pomo-display').innerText = `${m}:${s}`; }
        function startPomodoro() {
            if (isPomoRunning) { clearInterval(pomoInterval); document.getElementById('pomo-play-icon').classList.replace('fa-pause', 'fa-play'); isPomoRunning = false; }
            else {
                document.getElementById('pomo-play-icon').classList.replace('fa-play', 'fa-pause'); isPomoRunning = true;
                pomoInterval = setInterval(() => {
                    pomoTime--; updatePomoDisplay();
                    if (pomoTime <= 0) { clearInterval(pomoInterval); isPomoRunning = false; document.getElementById('pomo-play-icon').classList.replace('fa-pause', 'fa-play'); showToast(pomoMode === 'work' ? "Focus complete! Take a break." : "Break over! Back to work.", 'success'); switchPomodoroMode(); triggerConfetti(); }
                }, 1000);
            }
        }
        function resetPomodoro() { clearInterval(pomoInterval); isPomoRunning = false; document.getElementById('pomo-play-icon').classList.replace('fa-pause', 'fa-play'); pomoTime = pomoMode === 'work' ? 25 * 60 : 5 * 60; updatePomoDisplay(); }
        function switchPomodoroMode() {
            pomoMode = pomoMode === 'work' ? 'break' : 'work'; document.getElementById('pomo-mode').innerText = pomoMode === 'work' ? 'Deep Work' : 'Short Break';
            document.getElementById('pomo-mode').className = `text-[10px] font-black uppercase mt-4 tracking-widest relative z-10 inline-block px-4 py-1.5 rounded-xl border ${pomoMode === 'work' ? 'bg-brand-500/10 text-brand-500 border-brand-500/20' : 'bg-green-500/10 text-green-500 border-green-500/20'}`; resetPomodoro();
        }
        function focusTask(title) {
            pomoMode = 'work'; document.getElementById('pomo-mode').innerText = "Focus: " + title.substring(0, 15) + (title.length > 15 ? '...' : '');
            document.getElementById('pomo-mode').className = 'text-[10px] font-black uppercase mt-4 tracking-widest relative z-10 inline-block px-4 py-1.5 rounded-xl border bg-brand-500/10 text-brand-500 border-brand-500/20';
            resetPomodoro(); document.getElementById('pomodoro-widget').classList.remove('hidden'); updatePomoDisplay();
        }

        const pomoWidget = document.getElementById('pomodoro-widget'); let isDraggingPomo = false, cX, cY, iX, iY, xO = 0, yO = 0;
        pomoWidget.addEventListener("mousedown", (e) => { if (e.target.closest('button')) return; iX = e.clientX - xO; iY = e.clientY - yO; isDraggingPomo = true; });
        document.addEventListener("mouseup", () => { iX = cX; iY = cY; isDraggingPomo = false; });
        document.addEventListener("mousemove", (e) => { if (isDraggingPomo) { e.preventDefault(); cX = e.clientX - iX; cY = e.clientY - iY; xO = cX; yO = cY; pomoWidget.style.transform = `translate3d(${cX}px, ${cY}px, 0)`; } });


        const scratchInput = document.getElementById('scratchpad-input');
        scratchInput.value = Storage.get('scratchpad') || '';
        scratchInput.addEventListener('input', () => {
            Storage.set('scratchpad', scratchInput.value);
            document.getElementById('scratchpad-status').innerText = 'Saving...';
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => document.getElementById('scratchpad-status').innerText = 'Auto-saved', 500);
        });


        function parseTags(text) {
            const tags = text.match(/#[\w-]+/g) || [];
            const cleanTitle = text.replace(/#[\w-]+/g, '').trim();
            return { cleanTitle, tags };
        }

        function renderTasks() {
            const tasks = Storage.get('tasks'); const filter = document.getElementById('task-filter').value; const container = document.getElementById('task-list');
            let filtered = tasks; if (filter === 'active') filtered = tasks.filter(t => !t.completed); if (filter === 'completed') filtered = tasks.filter(t => t.completed);

            const total = tasks.length, comp = tasks.filter(t => t.completed).length;
            document.getElementById('task-progress-text').innerText = total === 0 ? '0% Done' : `${Math.round((comp / total) * 100)}% Done`;

            // Update task statistics
            updateTaskStats(tasks);

            container.innerHTML = filtered.map(task => {
                const isOverdue = task.dueDate && new Date(task.dueDate).getTime() < new Date().setHours(0, 0, 0, 0) && !task.completed;
                const dateHtml = task.dueDate ? `<span class="text-[10px] font-black uppercase px-2 py-1 rounded-lg ${isOverdue ? 'bg-red-500 text-white shadow-md shadow-red-500/30 animate-pulse' : 'bg-gray-100 dark:bg-gray-800 text-gray-500'} border ${isOverdue ? 'border-red-400' : 'border-gray-200 dark:border-gray-700'}"><i class="fa-regular fa-calendar mr-1"></i>${task.dueDate}</span>` : '';
                const pColor = task.priority === 'high' ? 'bg-red-500/10 text-red-500 border border-red-500/20' : task.priority === 'medium' ? 'bg-orange-500/10 text-orange-500 border border-orange-500/20' : 'bg-green-500/10 text-green-500 border border-green-500/20';
                const tagHtml = (task.tags || []).map(t => `<span class="text-[10px] font-black px-2 py-1 rounded-lg bg-brand-500/10 text-brand-500 border border-brand-500/20">${t}</span>`).join(' ');


                const subtasksHtml = task.subtasks && task.subtasks.length > 0 ?
                    `<div class="mt-2 text-xs">
                        <div class="flex items-center space-x-2 mb-1">
                            <span class="font-bold text-gray-500">Subtasks:</span>
                            <span class="text-gray-400">${task.subtasks.filter(st => st.completed).length}/${task.subtasks.length} completed</span>
                        </div>
                        <div class="space-y-1">
                            ${task.subtasks.map(st => `
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" ${st.completed ? 'checked' : ''} onchange="toggleSubtask(${task.id}, ${st.id})" class="task-checkbox w-4 h-4">
                                    <span class="text-gray-600 dark:text-gray-400 ${st.completed ? 'line-through' : ''}">${st.title}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>` : '';

                return `
                <div class="glass-panel !rounded-2xl p-4 flex items-center justify-between group hover:border-brand-500/40 transition-all shadow-sm hover:shadow-md">
                    <div class="flex items-center space-x-4 w-full overflow-hidden">
                        <input type="checkbox" ${task.completed ? 'checked' : ''} onchange="toggleTask(${task.id})" class="task-checkbox flex-shrink-0">
                        <div class="flex-1 min-w-0 flex flex-col pr-4">
                            <p class="text-lg font-bold truncate ${task.completed ? 'line-through text-gray-400 dark:text-gray-600' : 'text-gray-800 dark:text-gray-100'} transition-all">${task.title}</p>
                            ${task.description ? `<p class="text-sm text-gray-500 mt-1 truncate">${task.description}</p>` : ''}
                            <div class="flex items-center space-x-2 mt-1 flex-wrap gap-y-1">
                                ${dateHtml}
                                <span class="text-[10px] font-black uppercase px-2 py-1 rounded-lg ${pColor}">${task.priority}</span>
                                ${task.recurring ? `<span class="text-[10px] font-black uppercase px-2 py-1 rounded-lg bg-purple-500/10 text-purple-500 border border-purple-500/20">üîÅ ${task.recurring.frequency}</span>` : ''}
                                ${tagHtml}
                            </div>
                            ${subtasksHtml}
                        </div>
                    </div>
                    <div class="flex space-x-1 flex-shrink-0 opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="focusTask('${task.title.replace(/'/g, "\'")}')" class="text-gray-400 hover:text-brand-500 hover:bg-brand-500/10 w-10 h-10 rounded-xl transition-all tooltip flex items-center justify-center"><i class="fa-solid fa-crosshairs text-lg"></i></button>
                        <button onclick="editTask(${task.id})" class="text-gray-400 hover:text-blue-500 hover:bg-blue-500/10 w-10 h-10 rounded-xl transition-all flex items-center justify-center"><i class="fa-solid fa-edit"></i></button>
                        <button onclick="deleteTask(${task.id})" class="text-gray-400 hover:text-red-500 hover:bg-red-500/10 w-10 h-10 rounded-xl transition-all flex items-center justify-center"><i class="fa-solid fa-trash"></i></button>
                    </div>
                </div>`
            }).join('') || `<div class="text-center p-16 opacity-60"><div class="w-24 h-24 bg-gray-200 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner"><i class="fa-solid fa-check-double text-4xl text-gray-400"></i></div><p class="font-black text-2xl text-gray-500">You're all caught up!</p></div>`;
            updateDashboardStats();
        }


        function deleteTask(id) { Storage.set('tasks', Storage.get('tasks').filter(t => t.id !== id)); renderTasks(); }
        function clearCompletedTasks() { Storage.set('tasks', Storage.get('tasks').filter(t => !t.completed)); renderTasks(); showToast('Cleared Completed'); }


        function openAdvancedTaskModal() {
            document.getElementById('advanced-task-modal').classList.remove('hidden');
            setTimeout(() => document.getElementById('advanced-task-content').classList.remove('scale-95', 'opacity-0'), 10);
            document.getElementById('adv-task-date').valueAsDate = new Date();
            document.getElementById('subtasks-container').innerHTML = '';
        }

        function closeAdvancedTaskModal() {
            document.getElementById('advanced-task-content').classList.add('scale-95', 'opacity-0');
            setTimeout(() => document.getElementById('advanced-task-modal').classList.add('hidden'), 300);
        }

        function addSubtask() {
            const container = document.getElementById('subtasks-container');
            const subtaskId = Date.now() + Math.random();
            const subtaskHtml = `
                <div class="flex items-center space-x-2" id="subtask-${subtaskId}">
                    <input type="text" class="glass-input flex-1 text-sm" placeholder="Subtask description">
                    <button type="button" onclick="removeSubtask(${subtaskId})" class="text-red-500 hover:text-red-700">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', subtaskHtml);
        }

        function removeSubtask(id) {
            document.getElementById(`subtask-${id}`).remove();
        }

        function handleAdvancedTask(e) {
            e.preventDefault();

            const title = document.getElementById('adv-task-title').value.trim();
            if (!title) return;


            const subtaskInputs = document.querySelectorAll('#subtasks-container input[type="text"]');
            const subtasks = Array.from(subtaskInputs)
                .map(input => input.value.trim())
                .filter(value => value)
                .map((title, index) => ({
                    id: Date.now() + index,
                    title: title,
                    completed: false
                }));


            const isRecurring = document.getElementById('recurring-toggle').checked;
            const recurring = isRecurring ? {
                frequency: document.getElementById('recurring-frequency').value,
                count: parseInt(document.getElementById('recurring-count').value) || 10
            } : null;

            const tasks = Storage.get('tasks');
            const newTask = {
                id: Date.now(),
                title: title,
                description: document.getElementById('adv-task-desc').value.trim(),
                dueDate: document.getElementById('adv-task-date').value,
                priority: document.getElementById('adv-task-priority').value,
                completed: false,
                tags: [],
                subtasks: subtasks,
                recurring: recurring
            };

            tasks.unshift(newTask);
            Storage.set('tasks', tasks);

            // Reset form
            e.target.reset();
            document.getElementById('subtasks-container').innerHTML = '';
            document.getElementById('recurring-toggle').checked = false;
            document.getElementById('recurring-options').classList.add('hidden');

            closeAdvancedTaskModal();
            renderTasks();
            showToast('Advanced Task Created');
        }

        function toggleSubtask(taskId, subtaskId) {
            const tasks = Storage.get('tasks');
            const task = tasks.find(t => t.id === taskId);
            if (task && task.subtasks) {
                const subtask = task.subtasks.find(st => st.id === subtaskId);
                if (subtask) {
                    subtask.completed = !subtask.completed;
                    Storage.set('tasks', tasks);
                    renderTasks();
                    if (subtask.completed) {
                        showToast('Subtask completed!');
                    }
                }
            }
        }

        function editTask(taskId) {
            // In a real implementation, this would open an edit modal
            // For now, we'll just show a toast
            showToast('Edit feature coming soon!');
        }

        function updateTaskStats(tasks) {
            const completed = tasks.filter(t => t.completed).length;
            const pending = tasks.filter(t => !t.completed).length;
            const highPriority = tasks.filter(t => t.priority === 'high' && !t.completed).length;
            const overdue = tasks.filter(t => t.dueDate && new Date(t.dueDate).getTime() < new Date().setHours(0, 0, 0, 0) && !t.completed).length;

            document.getElementById('completed-tasks-count').innerText = completed;
            document.getElementById('pending-tasks-count').innerText = pending;
            document.getElementById('high-priority-count').innerText = highPriority;
            document.getElementById('overdue-count').innerText = overdue;
        }

        // Toggle recurring options visibility
        document.getElementById('recurring-toggle').addEventListener('change', function () {
            const options = document.getElementById('recurring-options');
            if (this.checked) {
                options.classList.remove('hidden');
            } else {
                options.classList.add('hidden');
            }
        });

        // --- 7. NOTES ---
        function renderNotes() {
            const notes = Storage.get('notes'); const search = document.getElementById('note-search').value.toLowerCase();
            const container = document.getElementById('notes-list');
            const filtered = notes.filter(n => n.title.toLowerCase().includes(search) || n.content.toLowerCase().includes(search)).sort((a, b) => b.updated - a.updated);

            container.innerHTML = filtered.map(note => `
                <div onclick="openNote(${note.id})" class="p-5 rounded-2xl cursor-pointer transition-all border ${currentNoteId === note.id ? 'bg-white/90 dark:bg-black/40 border-brand-500/50 shadow-md' : 'bg-white/50 dark:bg-black/20 border-transparent hover:border-gray-400/50 hover:shadow-sm'}">
                    <h4 class="font-black text-[16px] truncate mb-1 text-gray-800 dark:text-gray-100">${note.title || 'Untitled Document'}</h4>
                    <p class="text-xs font-bold text-gray-500 truncate leading-relaxed">${note.content.substring(0, 45) || 'Empty document...'}</p>
                </div>
            `).join('') || `<div class="text-center p-8 text-gray-500 font-bold">No documents found.</div>`;
            updateDashboardStats();
        }

        function createNewNote() {
            const notes = Storage.get('notes'); const newNote = { id: Date.now(), title: '', content: '', updated: Date.now() };
            notes.unshift(newNote); Storage.set('notes', notes); openNote(newNote.id); renderNotes(); document.getElementById('note-title').focus();
        }
        function openNote(id) {
            currentNoteId = id; const note = Storage.get('notes').find(n => n.id === id);
            document.getElementById('note-editor-empty').classList.add('hidden'); document.getElementById('note-editor').classList.remove('hidden'); document.getElementById('note-editor').classList.add('flex');
            document.getElementById('note-title').value = note.title; document.getElementById('note-content').value = note.content;
            document.getElementById('note-status').innerHTML = `<div class="w-2.5 h-2.5 rounded-full bg-green-500 mr-2 shadow-[0_0_8px_rgba(34,197,94,0.8)]"></div>Synced`; renderNotes();
        }
        function saveNoteDraft() {
            if (!currentNoteId) return;
            document.getElementById('note-status').innerHTML = `<div class="w-2.5 h-2.5 rounded-full bg-yellow-500 mr-2 animate-pulse shadow-[0_0_8px_rgba(234,179,8,0.8)]"></div>Saving...`;
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                const notes = Storage.get('notes'); const idx = notes.findIndex(n => n.id === currentNoteId);
                if (idx !== -1) {
                    notes[idx].title = document.getElementById('note-title').value; notes[idx].content = document.getElementById('note-content').value; notes[idx].updated = Date.now();
                    Storage.set('notes', notes); document.getElementById('note-status').innerHTML = `<div class="w-2.5 h-2.5 rounded-full bg-green-500 mr-2 shadow-[0_0_8px_rgba(34,197,94,0.8)]"></div>Synced`; renderNotes();
                }
            }, 600);
        }
        function deleteCurrentNote() {
            if (!currentNoteId || !confirm('Delete this document?')) return;
            Storage.set('notes', Storage.get('notes').filter(n => n.id !== currentNoteId)); currentNoteId = null;
            document.getElementById('note-editor').classList.add('hidden'); document.getElementById('note-editor').classList.remove('flex'); document.getElementById('note-editor-empty').classList.remove('hidden');
            renderNotes(); showToast('Document Deleted');
        }
        function insertMarkdown(prefix, suffix) {
            const textarea = document.getElementById('note-content'); const start = textarea.selectionStart; const end = textarea.selectionEnd; const text = textarea.value;
            textarea.value = text.substring(0, start) + prefix + text.substring(start, end) + suffix + text.substring(end, text.length);
            textarea.selectionStart = start + prefix.length; textarea.selectionEnd = end + prefix.length; textarea.focus(); saveNoteDraft();
        }

        // --- 8. HABITS ---
        function renderHabits() {
            const habits = Storage.get('habits'); const container = document.getElementById('habit-list');
            const dates = []; for (let i = 6; i >= 0; i--) { const d = new Date(); d.setDate(d.getDate() - i); dates.push(d.toISOString().split('T')[0]); }
            let headerHTML = `<div class="flex items-center mb-4 px-4"><div class="flex-1"></div><div class="flex space-x-3">`;
            dates.forEach(d => { headerHTML += `<div class="w-[34px] text-center text-[10px] font-black text-gray-400 uppercase tracking-widest">${new Date(d).toLocaleDateString('en-US', { weekday: 'narrow' })}</div>`; });
            headerHTML += `</div><div class="w-10 ml-4"></div></div>`;

            const listHTML = habits.map(h => {
                const gridHtml = dates.map(d => `<div onclick="toggleHabit(${h.id}, '${d}')" class="habit-day ${h.log[d] ? 'active' : 'inactive'}"><i class="fa-solid fa-check"></i></div>`).join('');
                return `<div class="glass-panel !rounded-2xl p-5 mb-4 flex items-center group shadow-sm hover:shadow-md hover:border-brand-500/30 transition-all duration-300"><div class="flex-1 font-black text-xl text-gray-800 dark:text-gray-100">${h.name}</div><div class="flex space-x-3 mr-4">${gridHtml}</div><button onclick="deleteHabit(${h.id})" class="w-10 h-10 rounded-xl text-gray-400 hover:text-red-500 hover:bg-red-500/10 transition-colors flex items-center justify-center md:opacity-0 group-hover:opacity-100"><i class="fa-solid fa-trash"></i></button></div>`;
            }).join('') || `<div class="text-center p-10 font-bold text-gray-500">No habits tracked yet.</div>`;
            container.innerHTML = headerHTML + listHTML;
        }
        function promptAddHabit() { const name = prompt("What daily habit do you want to build?"); if (name && name.trim()) { const habits = Storage.get('habits'); habits.push({ id: Date.now(), name: name.trim(), log: {} }); Storage.set('habits', habits); renderHabits(); } }
        function toggleHabit(id, date) { const habits = Storage.get('habits'); const h = habits.find(x => x.id === id); if (h) { h.log[date] = !h.log[date]; Storage.set('habits', habits); renderHabits(); if (h.log[date]) triggerConfetti(); } }
        function deleteHabit(id) { if (confirm('Delete habit?')) { Storage.set('habits', Storage.get('habits').filter(h => h.id !== id)); renderHabits(); } }

        // --- 9. EXPENSES (DYNAMIC CATEGORIES) ---
        function updateCategorySuggestions() {
            const expenses = Storage.get('expenses'); const uniqueCats = [...new Set(expenses.map(e => e.category))];
            document.getElementById('category-suggestions').innerHTML = uniqueCats.map(c => `<option value="${c}">`).join('');
        }

        function getCategoryStyle(cat) {
            const colors = ['text-pink-500 bg-pink-500/10 border-pink-500/20', 'text-blue-500 bg-blue-500/10 border-blue-500/20', 'text-green-500 bg-green-500/10 border-green-500/20', 'text-orange-500 bg-orange-500/10 border-orange-500/20', 'text-purple-500 bg-purple-500/10 border-purple-500/20', 'text-teal-500 bg-teal-500/10 border-teal-500/20'];
            let hash = 0; for (let i = 0; i < cat.length; i++) hash = cat.charCodeAt(i) + ((hash << 5) - hash);
            return colors[Math.abs(hash) % colors.length];
        }

        function renderExpenses() {
            const expenses = Storage.get('expenses').sort((a, b) => new Date(b.date) - new Date(a.date));
            const container = document.getElementById('expense-list'); const settings = Storage.getSettings(); let total = 0;

            container.innerHTML = expenses.map(exp => {
                total += parseFloat(exp.amount); const styleClass = getCategoryStyle(exp.category);
                return `
                <div class="glass-panel !rounded-2xl p-4 flex items-center justify-between group hover:border-brand-500/30 transition-all shadow-sm hover:shadow-md">
                    <div class="flex items-center space-x-4 truncate">
                        <div class="text-xl w-12 h-12 flex items-center justify-center rounded-xl flex-shrink-0 border ${styleClass} shadow-sm"><i class="fa-solid fa-tag"></i></div>
                        <div class="truncate pr-2">
                            <p class="font-black text-[17px] truncate leading-tight">${exp.desc}</p>
                            <div class="flex items-center space-x-2 mt-1">
                                <span class="text-[10px] font-black text-gray-500 uppercase tracking-widest">${exp.date}</span>
                                <span class="text-[9px] font-black uppercase px-2 py-0.5 rounded-md ${styleClass}">${exp.category}</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4 flex-shrink-0">
                        <span class="font-black text-2xl text-gray-800 dark:text-gray-100">-$${parseFloat(exp.amount).toFixed(2)}</span>
                        <button onclick="deleteExpense(${exp.id})" class="text-gray-400 hover:text-red-500 w-10 h-10 rounded-xl hover:bg-red-500/10 transition-colors md:opacity-0 group-hover:opacity-100 flex justify-center items-center"><i class="fa-solid fa-trash"></i></button>
                    </div>
                </div>`
            }).join('') || `<div class="text-center p-12 opacity-60"><div class="w-24 h-24 bg-gray-200 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner"><i class="fa-solid fa-wallet text-4xl text-gray-400"></i></div><p class="font-black text-xl text-gray-500">Ledger is empty.</p></div>`;

            document.getElementById('total-expenses-display').innerText = `$${total.toFixed(2)}`;
            const bPct = Math.min((total / settings.budget) * 100, 100); const bBar = document.getElementById('budget-bar');
            document.getElementById('budget-text').innerText = `Set Limit: $${settings.budget}`;
            bBar.style.width = `${bPct}%`; bBar.className = `h-full transition-all duration-700 ${bPct > 85 ? 'bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.8)]' : bPct > 50 ? 'bg-orange-500' : 'bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.5)]'}`;

            updateDashboardStats(); updateCategorySuggestions(); if (document.getElementById('expenses').classList.contains('active')) updateExpenseChartData(expenses);
        }

        function handleAddExpense(e) {
            e.preventDefault(); const expenses = Storage.get('expenses');
            expenses.push({ id: Date.now(), desc: document.getElementById('exp-desc').value.trim(), amount: parseFloat(document.getElementById('exp-amount').value), category: document.getElementById('exp-category').value.trim() || 'Other', date: document.getElementById('exp-date').value });
            Storage.set('expenses', expenses); e.target.reset(); document.getElementById('exp-date').valueAsDate = new Date(); renderExpenses(); showToast('Logged');
        }
        function deleteExpense(id) { Storage.set('expenses', Storage.get('expenses').filter(e => e.id !== id)); renderExpenses(); }
        function setBudget() { const s = Storage.getSettings(); const input = prompt("Enter Monthly Budget Limit ($):", s.budget); if (input && !isNaN(input)) { s.budget = parseFloat(input); Storage.setSettings(s); renderExpenses(); } }

        function initExpenseChart() {
            const ctx = document.getElementById('expenseChart').getContext('2d'); const isDark = document.documentElement.classList.contains('dark');
            if (expenseChartInstance) expenseChartInstance.destroy();
            expenseChartInstance = new Chart(ctx, {
                type: 'doughnut', data: { labels: [], datasets: [{ data: [], borderWidth: isDark ? 3 : 4, borderColor: isDark ? '#020617' : '#ffffff' }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, cutout: '75%' }
            });
            updateExpenseChartData(Storage.get('expenses'));
        }
        function updateExpenseChartData(expenses) {
            if (!expenseChartInstance) return;
            const totals = {}; expenses.forEach(e => { totals[e.category] = (totals[e.category] || 0) + parseFloat(e.amount); });
            const labels = Object.keys(totals); const data = Object.values(totals);
            const hexColors = ['#ec4899', '#3b82f6', '#10b981', '#f97316', '#a855f7', '#14b8a6', '#ef4444', '#f59e0b'];
            const bgColors = labels.map(l => { let hash = 0; for (let i = 0; i < l.length; i++) hash = l.charCodeAt(i) + ((hash << 5) - hash); return hexColors[Math.abs(hash) % hexColors.length]; });
            expenseChartInstance.data.labels = labels; expenseChartInstance.data.datasets[0].data = data; expenseChartInstance.data.datasets[0].backgroundColor = bgColors; expenseChartInstance.update();
        }

        // --- 10. SCHEDULE ---
        function renderSchedule() {
            const container = document.getElementById('timeline-grid'); const events = Storage.get('events'); container.innerHTML = '';
            for (let i = 0; i < 24; i++) {
                const hourDiv = document.createElement('div'); hourDiv.className = 'time-slot border-gray-300 dark:border-gray-700/50';
                hourDiv.innerHTML = `<span class="time-label text-gray-500 dark:text-gray-400 bg-transparent">${i === 0 ? '12 AM' : i < 12 ? i + ' AM' : i === 12 ? '12 PM' : (i - 12) + ' PM'}</span>`; container.appendChild(hourDiv);
            }
            events.forEach(ev => {
                const [startH, startM] = ev.start.split(':').map(Number); const [endH, endM] = ev.end.split(':').map(Number);
                const sM = (startH * 60) + startM; const dur = ((endH * 60) + endM) - sM;
                if (dur > 0) {
                    const block = document.createElement('div'); block.className = `event-block ${ev.color}`; block.style.top = `${sM}px`; block.style.height = `${dur}px`;
                    block.innerHTML = `<div class="flex justify-between h-full"><div class="overflow-hidden pr-2"><div class="font-black leading-tight truncate drop-shadow-sm text-[15px]">${ev.title}</div><div class="text-[10px] font-bold text-white/90 uppercase mt-0.5 tracking-wider">${ev.start} - ${ev.end}</div></div><button onclick="deleteEvent(${ev.id}, event)" class="text-white/70 hover:text-white bg-black/10 hover:bg-black/30 rounded-lg w-7 h-7 flex items-center justify-center transition-colors flex-shrink-0"><i class="fa-solid fa-xmark text-sm"></i></button></div>`;
                    container.appendChild(block);
                }
            });
            updateCurrentTimeLine(); setTimeout(() => { const now = new Date(); document.getElementById('timeline-scroll').scrollTop = Math.max(0, (now.getHours() * 60) + now.getMinutes() - 150); }, 50);
            updateDashboardStats();
        }

        function updateCurrentTimeLine() {
            const line = document.getElementById('current-time-line'); if (!document.getElementById('schedule').classList.contains('active')) return;
            const now = new Date(); line.style.top = `${(now.getHours() * 60) + now.getMinutes()}px`; line.classList.remove('hidden');
        }

        function openEventModal() { document.getElementById('event-modal').classList.remove('hidden'); setTimeout(() => document.getElementById('event-modal-content').classList.remove('scale-95', 'opacity-0'), 10); const now = new Date(); document.getElementById('ev-start').value = `${now.getHours().toString().padStart(2, '0')}:00`; document.getElementById('ev-end').value = `${(now.getHours() + 1).toString().padStart(2, '0')}:00`; }
        function closeEventModal() { document.getElementById('event-modal-content').classList.add('scale-95', 'opacity-0'); setTimeout(() => document.getElementById('event-modal').classList.add('hidden'), 300); }
        function handleSaveEvent(e) { e.preventDefault(); const start = document.getElementById('ev-start').value; const end = document.getElementById('ev-end').value; if (start >= end) { showToast('End time invalid', 'error'); return; } const events = Storage.get('events'); events.push({ id: Date.now(), title: document.getElementById('ev-title').value, start, end, color: document.querySelector('input[name="evcolor"]:checked').value }); Storage.set('events', events); closeEventModal(); renderSchedule(); showToast('Block Added'); }
        function deleteEvent(id, e) { e.stopPropagation(); Storage.set('events', Storage.get('events').filter(ev => ev.id !== id)); renderSchedule(); }

        // --- 11. DASHBOARD CHARTS ---
        function updateDashboardStats() {
            document.getElementById('dash-task-count').innerText = Storage.get('tasks').filter(x => !x.completed).length;
            document.getElementById('dash-note-count').innerText = Storage.get('notes').length;
            document.getElementById('dash-event-count').innerText = Storage.get('events').length;
            document.getElementById('dash-expense-total').innerText = `$${Storage.get('expenses').reduce((s, e) => s + parseFloat(e.amount), 0).toFixed(0)}`;
        }

        function initMainChart() {
            const ctx = document.getElementById('mainChart').getContext('2d'); const isDark = document.documentElement.classList.contains('dark');
            const tasks = Storage.get('tasks'); const labels = []; const dataPoints = [];
            for (let i = 6; i >= 0; i--) {
                const d = new Date(); d.setDate(d.getDate() - i); labels.push(d.toLocaleDateString('en-US', { weekday: 'short' }));
                const s = new Date(d).setHours(0, 0, 0, 0); const e = new Date(d).setHours(23, 59, 59, 999);
                dataPoints.push(tasks.filter(t => t.completed && t.date >= s && t.date <= e).length || Math.floor(Math.random() * 4));
            }
            if (mainChartInstance) mainChartInstance.destroy();
            const brandColor = getComputedStyle(document.documentElement).getPropertyValue('--brand-500').trim() || '#6366f1';
            const brandRgb = getComputedStyle(document.documentElement).getPropertyValue('--brand-rgb').trim() || '99, 102, 241';

            mainChartInstance = new Chart(ctx, {
                type: 'line',
                data: { labels: labels, datasets: [{ label: 'Completed', data: dataPoints, borderColor: brandColor, backgroundColor: (c) => { const grad = c.chart.ctx.createLinearGradient(0, 0, 0, 200); grad.addColorStop(0, `rgba(${brandRgb}, 0.5)`); grad.addColorStop(1, `rgba(${brandRgb}, 0)`); return grad; }, borderWidth: 4, tension: 0.4, fill: true, pointBackgroundColor: '#fff', pointBorderColor: brandColor, pointBorderWidth: 2, pointRadius: 4 }] },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { display: false, beginAtZero: true }, x: { grid: { display: false }, border: { display: false }, ticks: { color: isDark ? '#9ca3af' : '#6b7280', font: { family: "'Plus Jakarta Sans'", weight: '800' } } } }, plugins: { legend: { display: false } }, interaction: { intersect: false, mode: 'index' } }
            });
        }

        // --- 12. SETTINGS ---
        function openSettings() { document.getElementById('setting-name').value = Storage.getSettings().name || ''; document.getElementById('settings-modal').classList.remove('hidden'); setTimeout(() => document.getElementById('settings-modal-content').classList.remove('scale-95', 'opacity-0'), 10); if (window.innerWidth < 768) toggleSidebar(); }
        function closeSettings() { document.getElementById('settings-modal-content').classList.add('scale-95', 'opacity-0'); setTimeout(() => document.getElementById('settings-modal').classList.add('hidden'), 300); }
        function saveName() { const s = Storage.getSettings(); s.name = document.getElementById('setting-name').value.trim() || 'Creator'; Storage.setSettings(s); updateDateTime(); showToast('Saved'); }
        function exportAllData() { const blob = new Blob([JSON.stringify({ tasks: Storage.get('tasks'), notes: Storage.get('notes'), expenses: Storage.get('expenses'), events: Storage.get('events'), habits: Storage.get('habits'), settings: Storage.getSettings() }, null, 2)], { type: 'application/json' }); const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = `focussphere_backup.json`; link.click(); showToast('Exported'); }
        function importAllData(event) { const file = event.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = function (e) { try { const d = JSON.parse(e.target.result);['tasks', 'notes', 'expenses', 'events', 'habits'].forEach(k => { if (d[k]) Storage.set(k, d[k]); }); if (d.settings) Storage.setSettings(d.settings); showToast('Restored! Reloading...'); setTimeout(() => location.reload(), 1500); } catch (err) { showToast('Invalid File', 'error'); } }; reader.readAsText(file); }
        function factoryReset() { if (confirm("WARNING: Delete all data?")) { localStorage.clear(); location.reload(); } }

        // --- Analytics Dashboard ---
        let completionChartInstance = null;
        let productivityChartInstance = null;
        let moodChartInstance = null;

        function updateAnalytics() {
            const period = parseInt(document.getElementById('analytics-period').value);
            const tasks = Storage.get('tasks');
            const expenses = Storage.get('expenses');
            const habits = Storage.get('habits');
            const notes = Storage.get('notes');
            const events = Storage.get('events');

            // Calculate metrics
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - period);

            // Task analytics
            const completedTasks = tasks.filter(t => t.completed && new Date(t.date || Date.now()) >= startDate).length;
            const totalTasks = tasks.filter(t => new Date(t.date || Date.now()) >= startDate).length;
            const pendingTasks = totalTasks - completedTasks;
            const highPriorityTasks = tasks.filter(t => t.priority === 'high' && !t.completed && new Date(t.date || Date.now()) >= startDate).length;

            // Expense analytics
            const recentExpenses = expenses.filter(e => new Date(e.date) >= startDate);
            const totalExpenses = recentExpenses.reduce((sum, e) => sum + parseFloat(e.amount), 0);
            const expenseCategories = {};
            recentExpenses.forEach(e => {
                expenseCategories[e.category] = (expenseCategories[e.category] || 0) + parseFloat(e.amount);
            });

            // Habit analytics
            let currentStreak = 0;
            const today = new Date().toISOString().split('T')[0];
            for (let i = 0; i < 365; i++) {
                const checkDate = new Date();
                checkDate.setDate(checkDate.getDate() - i);
                const dateStr = checkDate.toISOString().split('T')[0];

                const hasHabit = habits.some(h => h.log[dateStr]);
                if (hasHabit) {
                    currentStreak++;
                } else if (dateStr !== today) {
                    break;
                }
            }

            // Note analytics
            const recentNotes = notes.filter(n => new Date(n.updated) >= startDate);
            const totalWords = recentNotes.reduce((sum, n) => sum + (n.content ? n.content.split(' ').length : 0), 0);

            // Event analytics
            const recentEvents = events.filter(e => new Date(e.date || Date.now()) >= startDate);
            const totalEventHours = recentEvents.reduce((sum, e) => {
                if (e.start && e.end) {
                    const [startH, startM] = e.start.split(':').map(Number);
                    const [endH, endM] = e.end.split(':').map(Number);
                    const duration = ((endH * 60) + endM) - ((startH * 60) + startM);
                    return sum + (duration / 60);
                }
                return sum;
            }, 0);

            // Update display
            document.getElementById('total-tasks-completed').innerText = completedTasks;
            document.getElementById('habits-streak').innerText = currentStreak;
            document.getElementById('total-expenses-analytics').innerText = `$${totalExpenses.toFixed(0)}`;
            document.getElementById('focus-hours').innerText = `${Math.floor(totalEventHours + (pomoTime / 3600))}h`;

            // Update task statistics
            document.getElementById('completed-tasks-count').innerText = completedTasks;
            document.getElementById('pending-tasks-count').innerText = pendingTasks;
            document.getElementById('high-priority-count').innerText = highPriorityTasks;

            // Update weekly activity with real data
            updateWeeklyActivity(tasks, habits, events, startDate);

            updateAnalyticsCharts(period);
            updateMoodChart(period);
        }

        function initAnalyticsCharts() {
            // Initialize charts with default 30-day period
            updateAnalyticsCharts(30);
            updateMoodChart(30);
        }

        function updateWeeklyActivity(tasks, habits, events, startDate) {
            const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
            const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

            days.forEach((day, index) => {
                const dayDate = new Date();
                dayDate.setDate(dayDate.getDate() - (6 - index)); // Get last 7 days
                const dateStr = dayDate.toISOString().split('T')[0];

                // Calculate activity score for this day
                let activityScore = 0;

                // Task completion activity
                const dailyTasks = tasks.filter(t => {
                    const taskDate = new Date(t.date || Date.now());
                    return taskDate.toDateString() === dayDate.toDateString() && t.completed;
                });
                activityScore += dailyTasks.length * 15;

                // Habit activity
                const dailyHabits = habits.filter(h => h.log[dateStr]);
                activityScore += dailyHabits.length * 10;

                // Event activity
                const dailyEvents = events.filter(e => {
                    const eventDate = new Date(e.date || Date.now());
                    return eventDate.toDateString() === dayDate.toDateString();
                });
                activityScore += dailyEvents.length * 8;

                // Normalize to 0-100 scale
                const normalizedScore = Math.min(100, Math.max(10, activityScore));

                document.getElementById(`${day}-activity`).style.height = `${normalizedScore}%`;
            });
        }

        function updateAnalyticsCharts(period) {
            const tasks = Storage.get('tasks');
            const habits = Storage.get('habits');
            const events = Storage.get('events');
            const labels = [];
            const completionData = [];
            const productivityData = [];

            // Generate data for the selected period
            for (let i = period - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));

                // Real completion rate data
                const dailyTasks = tasks.filter(t => {
                    const taskDate = new Date(t.date || Date.now());
                    return taskDate.toDateString() === date.toDateString();
                });
                const completed = dailyTasks.filter(t => t.completed).length;
                const total = dailyTasks.length;
                const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;
                completionData.push(completionRate);

                // Real productivity score based on multiple factors
                let productivityScore = 50; // Base score

                // Task completion contribution
                productivityScore += completionRate * 0.3;

                // Habit completion contribution
                const dailyHabits = habits.filter(h => h.log[dateStr]);
                productivityScore += dailyHabits.length * 8;

                // Event scheduling contribution
                const dailyEvents = events.filter(e => {
                    const eventDate = new Date(e.date || Date.now());
                    return eventDate.toDateString() === date.toDateString();
                });
                productivityScore += dailyEvents.length * 5;

                // Ensure score is between 0-100
                productivityScore = Math.min(100, Math.max(0, productivityScore));
                productivityData.push(Math.round(productivityScore));
            }

            // Update completion chart
            updateCompletionChart(labels, completionData);

            // Update productivity chart
            updateProductivityChart(labels, productivityData);
        }

        function updateCompletionChart(labels, data) {
            const ctx = document.getElementById('completionChart').getContext('2d');
            if (completionChartInstance) completionChartInstance.destroy();

            completionChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Completion Rate',
                        data: data,
                        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--brand-500').trim(),
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function (value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateProductivityChart(labels, data) {
            const ctx = document.getElementById('productivityChart').getContext('2d');
            if (productivityChartInstance) productivityChartInstance.destroy();

            productivityChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Productivity Score',
                        data: data,
                        backgroundColor: [
                            'rgba(79, 70, 229, 0.7)',
                            'rgba(236, 72, 153, 0.7)',
                            'rgba(16, 185, 129, 0.7)',
                            'rgba(245, 158, 11, 0.7)',
                            'rgba(139, 92, 246, 0.7)',
                            'rgba(14, 165, 233, 0.7)',
                            'rgba(244, 63, 94, 0.7)'
                        ],
                        borderColor: [
                            'rgb(79, 70, 229)',
                            'rgb(236, 72, 153)',
                            'rgb(16, 185, 129)',
                            'rgb(245, 158, 11)',
                            'rgb(139, 92, 246)',
                            'rgb(14, 165, 233)',
                            'rgb(244, 63, 94)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }



        // --- BOOTSTRAP ---
        window.addEventListener('DOMContentLoaded', () => {
            // Show loading screen briefly
            setTimeout(() => {
                const loadingScreen = document.getElementById('loading-screen');
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            }, 1500);

            const theme = Storage.getSettings().theme || 'indigo'; changeTheme(theme);
            document.getElementById('exp-date').valueAsDate = new Date(); document.getElementById('task-date').valueAsDate = new Date();
            updateDateTime(); setInterval(updateDateTime, 60000); setInterval(updateCurrentTimeLine, 60000);

            // Initialize new features
            refreshWeather();
            startQuoteRotation();

            navigate('dashboard'); renderTasks(); renderNotes(); renderExpenses(); renderSchedule(); renderHabits();
        });
    </script>

    <script>
        // --- Mood Analytics Chart ---
        function updateMoodChart(period) {
            const moods = Storage.get('moods') || [];
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - period);

            // Filter moods within the period
            const recentMoods = moods.filter(m => new Date(m.timestamp) >= startDate);

            // Group by date and mood type
            const moodData = {};
            const moodTypes = ['Awesome', 'Good', 'Tired', 'Stressed'];

            // Initialize data structure
            for (let i = period - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                moodData[dateStr] = { Awesome: 0, Good: 0, Tired: 0, Stressed: 0 };
            }

            // Count moods by date
            recentMoods.forEach(mood => {
                const dateStr = new Date(mood.timestamp).toISOString().split('T')[0];
                if (moodData[dateStr]) {
                    moodData[dateStr][mood.mood] = (moodData[dateStr][mood.mood] || 0) + 1;
                }
            });

            // Prepare chart data
            const labels = Object.keys(moodData).map(date => {
                const d = new Date(date);
                return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });

            const datasets = moodTypes.map((mood, index) => {
                const colors = ['#10b981', '#6366f1', '#f59e0b', '#ef4444']; // Green, Indigo, Amber, Red
                return {
                    label: mood,
                    data: Object.values(moodData).map(day => day[mood]),
                    backgroundColor: colors[index],
                    borderColor: colors[index],
                    borderWidth: 2,
                    tension: 0.4,
                    fill: false
                };
            });

            const ctx = document.getElementById('moodChart').getContext('2d');
            const isDark = document.documentElement.classList.contains('dark');

            if (moodChartInstance) moodChartInstance.destroy();

            moodChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                color: isDark ? '#9ca3af' : '#6b7280',
                                font: {
                                    family: "'Plus Jakarta Sans'",
                                    weight: '800'
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            border: {
                                display: false
                            },
                            ticks: {
                                color: isDark ? '#9ca3af' : '#6b7280',
                                font: {
                                    family: "'Plus Jakarta Sans'",
                                    weight: '800'
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: isDark ? '#e5e7eb' : '#374151',
                                font: {
                                    family: "'Plus Jakarta Sans'",
                                    weight: '800',
                                    size: 12
                                },
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: isDark ? 'rgba(31, 41, 55, 0.9)' : 'rgba(255, 255, 255, 0.9)',
                            titleColor: isDark ? '#f3f4f6' : '#1f2937',
                            bodyColor: isDark ? '#d1d5db' : '#4b5563',
                            borderColor: isDark ? '#4b5563' : '#e5e7eb',
                            borderWidth: 1,
                            padding: 12,
                            usePointStyle: true,
                            callbacks: {
                                label: function (context) {
                                    return `${context.dataset.label}: ${context.parsed.y} times`;
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }
    </script>
</body>

</html>